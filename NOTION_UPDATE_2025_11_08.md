# 📅 2025-11-08 업데이트 내역

## ✅ 쪽지함 UI/UX 개선

### 주요 개선 사항

#### 1. 탭 UI 개선
- **아이콘 추가**: 각 탭에 의미있는 아이콘 추가 (Mail, MessageSquare, Building2, UserPlus, Send, FileText)
- **하이라이트 기능**: 대기 중인 항목이 있는 탭에 파란색 테두리로 강조 표시
- **스크롤 가능한 탭 바**: 모바일 환경에서도 모든 탭에 접근 가능
- **활성 탭 강조**: 선택된 탭은 파란색 배경과 흰색 텍스트로 명확히 구분

#### 2. 메시지 카드 디자인 개선
- **그라데이션 배경 아이콘**: 각 메시지 타입별로 구분되는 아이콘 배경
- **대기 중인 메시지 강조**: 파란색 테두리와 그림자 효과로 주목도 향상
- **정보 계층 구조 개선**: 제목, 부제목, 메시지 내용, 시간의 명확한 시각적 구분
- **호버 효과**: 마우스 오버 시 테두리 색상 변화 및 그림자 강화

#### 3. 설명 박스 개선
- **접기 기능 추가**: X 버튼으로 설명 박스 닫기 가능
- **정보 아이콘**: 더 명확한 정보 표시를 위한 아이콘 추가
- **공간 효율성**: 사용자가 닫으면 더 많은 공간 확보

#### 4. 날짜 표시 개선
- **상대 시간 표시**: "방금 전", "5분 전", "2시간 전", "3일 전" 등 직관적인 표시
- **캘린더 아이콘**: 시간 정보를 더 명확하게 표시
- **간결한 표시**: 긴 날짜 형식 대신 사용자 친화적인 형식 사용

#### 5. 액션 버튼 개선
- **아이콘 추가**: 각 버튼에 의미있는 아이콘 추가 (CheckCircle, XCircle, ChevronRight 등)
- **일관된 크기**: 모든 버튼을 `size="sm"`으로 통일하여 깔끔한 UI
- **반응형 레이아웃**: `flex-wrap`으로 작은 화면에서도 버튼이 잘 배치됨

#### 6. 빈 상태 UI 개선
- **더 큰 아이콘**: 12x12 크기의 아이콘으로 시각적 임팩트 향상
- **그라데이션 배경**: 아이콘 배경에 그라데이션 효과 적용
- **명확한 메시지**: 사용자에게 친절한 안내 메시지 제공

#### 7. 추가 개선 사항
- **새로고침 버튼**: 헤더에 새로고침 버튼 추가로 최신 메시지 확인 가능
- **일관된 간격**: 모든 섹션에 `space-y-3` 적용으로 통일된 레이아웃
- **반응형 디자인**: 모바일과 데스크톱 환경 모두에서 최적화된 UI

### 기술적 개선

#### 컴포넌트 구조화
- **TabButton 컴포넌트**: 재사용 가능한 탭 버튼 컴포넌트 생성
- **MessageCard 컴포넌트**: 일관된 메시지 카드 디자인을 위한 컴포넌트
- **EmptyState 컴포넌트**: 빈 상태를 표시하는 재사용 가능한 컴포넌트

#### 유틸리티 함수
- **formatRelativeTime**: 상대 시간을 계산하는 함수 추가

---

## ✅ Supabase 테이블 연동 개선

### 팀 견적 요청 (notifications 테이블)

#### 개선 전 문제점
- `counsel_id`가 null인 경우 처리 부족
- 에러 처리 미흡
- 빈 결과 처리 부족

#### 개선 사항
- ✅ **null 처리 강화**: `counsel_id`가 null이거나 undefined인 경우 필터링
- ✅ **에러 처리 강화**: 각 단계별 에러 처리 및 로깅 추가
- ✅ **빈 결과 처리**: 데이터가 없을 때 빈 배열로 초기화
- ✅ **안정성 향상**: 각 쿼리 단계별 에러 핸들링으로 안정적인 데이터 조회

#### 쿼리 구조
```typescript
// 1. notifications 테이블에서 견적 요청 조회
// 2. 팀 정보 별도 조회 (teams 테이블)
// 3. 프로젝트 정보 별도 조회 (counsel 테이블, counsel_id가 있는 경우만)
// 4. 데이터 결합 및 포맷팅
```

### 프로젝트 제안 (project_members 테이블)

#### 개선 전 문제점
- PostgREST 중첩 조인(`counsel:counsel_id`) 사용으로 불안정
- 조인 실패 시 대비 부족

#### 개선 사항
- ✅ **PostgREST 조인 제거**: 중첩 조인 대신 별도 쿼리로 변경하여 안정성 향상
- ✅ **단계별 쿼리**: 
  1. `project_members` 테이블에서 기본 정보 조회
  2. `counsel` 테이블에서 프로젝트 정보 별도 조회
  3. `client` 테이블에서 클라이언트 정보 조회
  4. `accounts` 테이블에서 계정 정보 조회
- ✅ **에러 처리 강화**: 각 단계별 에러 처리 및 로깅 추가
- ✅ **빈 결과 처리**: 데이터가 없을 때 빈 배열로 초기화

#### 쿼리 구조
```typescript
// 1. project_members 테이블에서 기본 정보 조회
// 2. counsel_id 목록 추출
// 3. counsel 테이블에서 프로젝트 정보 별도 조회
// 4. client_id 목록 추출
// 5. client 테이블에서 클라이언트 정보 조회
// 6. accounts 테이블에서 계정 정보 조회
// 7. 데이터 결합 및 포맷팅
```

### 데이터 타입 확인

- ✅ `notifications.counsel_id`: `integer` 타입
- ✅ `project_members.counsel_id`: `integer` 타입  
- ✅ `counsel.counsel_id`: `bigint` 타입
- ✅ PostgreSQL 자동 캐스팅으로 타입 불일치 문제 없음

### 개선 효과

#### 안정성
- PostgREST 조인 대신 별도 쿼리 사용으로 안정성 향상
- 각 단계별 에러 처리로 부분 실패 시에도 안정적 동작

#### 성능
- 필요한 데이터만 조회하여 불필요한 조인 제거
- 인덱스 활용으로 쿼리 성능 향상

#### 유지보수성
- 단계별 주석으로 코드 가독성 향상
- 명확한 에러 메시지로 디버깅 용이

---

## 📊 개선 전후 비교

### UI/UX
- **이전**: 단조로운 탭 디자인, 긴 날짜 형식, 단순한 카드 디자인
- **개선**: 아이콘과 하이라이트가 있는 탭, 상대 시간 표시, 시각적으로 개선된 카드

### 데이터 연동
- **이전**: PostgREST 조인에 의존, 에러 처리 부족
- **개선**: 별도 쿼리로 안정성 향상, 강화된 에러 처리

### 사용자 경험
- **이전**: 정보 파악이 어려운 UI
- **개선**: 직관적이고 시각적으로 명확한 정보 표시

---

## 📝 관련 파일

- `src/app/(home)/my/messages/MessagesClient.tsx`
- 주요 변경: UI/UX 개선 및 Supabase 쿼리 로직 개선

