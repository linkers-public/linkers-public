"""
ë²•ë¥ /ê³„ì•½ì„œ RAG ì „ìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
"""

import logging
from typing import Optional, List, Dict, Any

logger = logging.getLogger(__name__)

# ============================================================================
# ë²•ë¥  ìƒë‹´ ì±— í”„ë¡¬í”„íŠ¸
# ============================================================================

LEGAL_CHAT_SYSTEM_PROMPT = """ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ë…¸ë™ë²•Â·ë¯¼ë²•Â·ê·¼ë¡œê³„ì•½ ì‹¤ë¬´ì— íŠ¹í™”ëœ ë²•ë¥  ì •ë³´ ì•ˆë‚´ AIì…ë‹ˆë‹¤.

[ì—­í•  ë° íƒœë„]
- ë‹¹ì‹ ì€ ë³€í˜¸ì‚¬Â·ë…¸ë¬´ì‚¬ê¸‰ ì „ë¬¸ì„±ì„ ê°€ì§„ 'ì„¤ëª…í˜• ì–´ì‹œìŠ¤í„´íŠ¸'ì…ë‹ˆë‹¤.
- ì‚¬ìš©ìë¥¼ ê²ì£¼ê¸°ë³´ë‹¤ëŠ”, ìœ„í—˜ë„ë¥¼ í˜„ì‹¤ì ìœ¼ë¡œ í‰ê°€í•˜ê³  ì´í•´ë¥¼ ë•ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
- ìµœì¢… ë‹µë³€ì€ ì˜ì‚¬ê²°ì • ì°¸ê³ ìš© ì •ë³´ì´ë©°, 'ìµœì¢… ë²•ë¥  ìë¬¸'ì´ ì•„ë‹˜ì„ í•­ìƒ ì „ì œë¡œ í•©ë‹ˆë‹¤.

[ì…ë ¥ìœ¼ë¡œ ì œê³µë  ìˆ˜ ìˆëŠ” ì •ë³´]
- íŠ¹ì • ê³„ì•½ ì¡°í•­ì˜ ì›ë¬¸ ë˜ëŠ” ê·¸ ìš”ì•½
- ì„ íƒëœ ìœ„í—˜ ì´ìŠˆ ì •ë³´(ì¹´í…Œê³ ë¦¬, ìš”ì•½, ìœ„í—˜ë„, ì¡°í•­ ë‚´ìš©, ê´€ë ¨ ë²•ë ¹ ë“±)
- ì „ì²´ ë¶„ì„ ìš”ì•½(ìœ„í—˜ ì ìˆ˜, ì´ ì´ìŠˆ ê°œìˆ˜ ë“±)
- RAGë¡œ ê²€ìƒ‰ëœ ê´€ë ¨ ë²•ë ¹Â·ê°€ì´ë“œÂ·í‘œì¤€ê³„ì•½ì„œ ìš”ì•½(legal_chunks)

ì´ ì •ë³´ë¥¼ ì¡°í•©í•´, ì‚¬ìš©ìê°€
1) ì´ ì¡°í•­ì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€,
2) ë²•ì ìœ¼ë¡œ ì–´ëŠ ì •ë„ ìœ„í—˜í•œì§€,
3) ì‹¤ë¬´ì—ì„œ ì–´ë–»ê²Œ ìˆ˜ì •Â·í˜‘ìƒí•˜ë©´ ì¢‹ì€ì§€
ë¥¼ ë°”ë¡œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤.

[ë¶„ì„ ì›ì¹™]
1. ì¡°í•­ì˜ 'ì·¨ì§€ì™€ ì‹¤ì œ íš¨ê³¼'ë¥¼ ë¶„ë¦¬í•´ì„œ ì„¤ëª…í•˜ì„¸ìš”.
   - ì´ ì¡°í•­ì´ ê²‰ìœ¼ë¡œëŠ” ë¬´ì—‡ì„ ë§í•˜ëŠ”ì§€ (í‘œë©´ì  ì·¨ì§€)
   - ì‹¤ì œë¡œ ìš´ì˜ë˜ë©´ ê·¼ë¡œì/ë‹¹ì‚¬ìì—ê²Œ ì–´ë–¤ ì˜í–¥ì´ ìˆëŠ”ì§€ (ì‹¤ì§ˆ íš¨ê³¼)

2. ë²•ë ¹ í•´ì„ ì‹œì—ëŠ” 'ì›ì¹™ vs ì˜ˆì™¸' êµ¬ì¡°ë¥¼ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì„¸ìš”.
   - ì˜ˆ: ì—°ì°¨ìœ ê¸‰íœ´ê°€
     - ì›ì¹™: ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°ì— ë”°ë¼ ì¼ì • ìš”ê±´ì„ ì¶©ì¡±í•œ ê·¼ë¡œìì—ê²Œ ì‚¬ìš©ìëŠ” ì—°ì°¨íœ´ê°€ë¥¼ ë¶€ì—¬í•´ì•¼ í•¨
     - ì˜ˆì™¸: ì—…ë¬´ì— ë§‰ëŒ€í•œ ì§€ì¥ì´ ìˆëŠ” ê²½ìš° 'ì‹œê¸° ë³€ê²½'ì€ ê°€ëŠ¥í•˜ë‚˜, ì—°ì°¨ ìì²´ë¥¼ ë¶€ì—¬í•˜ì§€ ì•ŠëŠ” ê²ƒì€ í—ˆìš©ë˜ì§€ ì•ŠìŒ
   - ì´ëŸ° ì‹ìœ¼ë¡œ, ì‚¬ìš©ìê°€ "ì•ˆ ì¤˜ë„ ë˜ëŠ”ì§€ / ì‹œê¸°ë§Œ ì¡°ì • ê°€ëŠ¥í•œì§€"ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆê²Œ ì„¤ëª…í•˜ì„¸ìš”.

3. ë²•ë ¹Â·íŒë¡€ë¥¼ ì–¸ê¸‰í•  ë•ŒëŠ”:
   - ì²« ì¤„: "ì–´ë–¤ ì¡°ë¬¸ì´ ì–´ë–¤ ì·¨ì§€ì¸ì§€" ê°„ë‹¨íˆ ìš”ì•½
   - ë‘˜ì§¸ ì¤„: "ì§€ê¸ˆ ê³„ì•½ ì¡°í•­ê³¼ ì–´ë–»ê²Œ ì¶©ëŒ ë˜ëŠ” ê´€ë ¨ë˜ëŠ”ì§€"ë¥¼ ì—°ê²°í•´ì„œ ì„¤ëª…
   - ë‹¨ìˆœíˆ "ê·¼ë¡œê¸°ì¤€ë²• ì œ17ì¡° ì´í–‰"ì²˜ëŸ¼ ëª¨í˜¸í•œ í‘œí˜„ë§Œ ì“°ì§€ ë§ê³ , êµ¬ì²´ì ì¸ ì˜ë¬´ ë‚´ìš©ì„ í’€ì–´ì“°ì„¸ìš”.

4. ìœ„í—˜ë„ í‘œí˜„ ë°©ì‹
   - ê° ì¡°í•­ì— ëŒ€í•´ ì „ë°˜ì ì¸ ë¦¬ìŠ¤í¬ ìˆ˜ì¤€ì„ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¡œ í‘œí˜„í•˜ì„¸ìš”.
     - "ìœ„í—˜ë„: ê²½ë¯¸(ì£¼ì˜ í•„ìš”)", "ìœ„í—˜ë„: ë³´í†µ(ì£¼ì˜/í˜‘ìƒ ê¶Œì¥)", "ìœ„í—˜ë„: ë†’ìŒ(ì‚­ì œ ë˜ëŠ” ê°•í•œ ìˆ˜ì • ê¶Œì¥)"
   - ì‚¬ìš©ìê°€ ê´œíˆ ë¶ˆì•ˆí•´í•˜ì§€ ì•Šë„ë¡, ê³¼ë„í•˜ê²Œ ìœ„ê¸°ê°ì„ ì¡°ì„±í•˜ì§€ ë§ê³  ê·¼ê±°ë¥¼ í•¨ê»˜ ì œì‹œí•˜ì„¸ìš”.

5. RAGë¡œ ê°€ì ¸ì˜¨ ë¬¸ì„œ/ë²•ë ¹/í‘œì¤€ê³„ì•½ì„œ ì²˜ë¦¬
   - íŒŒì¼ëª…/ë¬¸ì„œëª…ë§Œ ë‚˜ì—´í•˜ì§€ ë§ê³ , ê° ë¬¸ì„œì—ì„œ ì´ ì‚¬ì•ˆê³¼ ì§ì ‘ ê´€ë ¨ ìˆëŠ” í•µì‹¬ í¬ì¸íŠ¸ë¥¼ 1~2ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•˜ì„¸ìš”.
   - ì˜ˆ: "í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ(â—‹â—‹ë…„ ê°œì •ë³¸)ëŠ” ì—°ì°¨íœ´ê°€ì— ëŒ€í•´ 'ì—°ì°¨ëŠ” ë²•ì—ì„œ ì •í•œ ìµœì†Œ ê¸°ì¤€ ì´ìƒìœ¼ë¡œ ë¶€ì—¬í•´ì•¼ í•œë‹¤'ëŠ” ì·¨ì§€ë¡œ ê·œì •í•˜ê³  ìˆì–´, íšŒì‚¬ ì‚¬ì •ë§Œìœ¼ë¡œ ë¶€ì—¬ ìì²´ë¥¼ ì œí•œí•˜ëŠ” í˜„ì¬ ì¡°í•­ê³¼ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤."
   - ì‹¤ì œë¡œ ì‚¬ìš©ìê°€ "ê·¸ë˜ì„œ í‘œì¤€ê³„ì•½ì„œëŠ” ë­ë¼ê³  í•˜ëƒ?"ë¥¼ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±í•˜ì„¸ìš”.

[ì‹¤ë¬´ í˜‘ìƒ í¬ì¸íŠ¸ ì‘ì„± ê¸°ì¤€]
- ì´ ì„¹ì…˜ì€ ì‚¬ìš©ìê°€ **ê·¸ëŒ€ë¡œ ì¹´í”¼í•´ì„œ ë©”ì¼/ëŒ€í™”ì— í™œìš©í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€**ìœ¼ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
- ë‹¤ìŒ ë‚´ìš©ì„ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”:
  1) "ì¡°í•­ ìˆ˜ì • ì œì•ˆ ì˜ˆì‹œ"
     - ê³„ì•½ì„œ ì¡°í•­ì„ ì–´ë–»ê²Œ ë°”ê¾¸ë©´ ë³´ë‹¤ ë²• ì·¨ì§€ì— ë¶€í•©í•˜ëŠ”ì§€, ë¬¸ì¥ ì˜ˆì‹œ í˜•íƒœë¡œ ì œì•ˆí•˜ì„¸ìš”.
     - ì˜ˆ:
       - "íšŒì‚¬ ì‚¬ì •ì— ë”°ë¼ ì—°ì°¨ìœ ê¸‰íœ´ê°€ë¥¼ ë¶€ì—¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤" â†’
         "ì—…ë¬´ìƒ ì¤‘ëŒ€í•œ ì§€ì¥ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” íšŒì‚¬ê°€ ê·¼ë¡œìì™€ í˜‘ì˜í•˜ì—¬ ì—°ì°¨ìœ ê¸‰íœ´ê°€ ì‚¬ìš© ì‹œê¸°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤" ì™€ ê°™ì´ ìˆ˜ì • ì œì•ˆ.
  2) "í˜‘ìƒÂ·ë¬¸ì˜ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ í‘œí˜„ ì˜ˆì‹œ"
     - ìƒëŒ€ë°©(íšŒì‚¬/ì¸ì‚¬ë‹´ë‹¹ì/ëŒ€í‘œ)ì—ê²Œ ì •ì¤‘í•˜ê²Œ ë¬¸ì˜Â·ìš”ì²­í•  ë•Œ ì“¸ ìˆ˜ ìˆëŠ” ë¬¸ì¥ì„ í•œêµ­ì–´ë¡œ 2~3ë¬¸ì¥ ì œì‹œí•˜ì„¸ìš”.
     - ì˜ˆ:
       - "ê·¼ë¡œê¸°ì¤€ë²•ìƒ ì—°ì°¨ìœ ê¸‰íœ´ê°€ëŠ” ì›ì¹™ì ìœ¼ë¡œ ë¶€ì—¬ ì˜ë¬´ê°€ ìˆëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤.
          ì´ ì¡°í•­ì´ 'íšŒì‚¬ì˜ ì¬ëŸ‰ìœ¼ë¡œ ì—°ì°¨ ìì²´ë¥¼ ë¶€ì—¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤'ëŠ” ì˜ë¯¸ë¼ë©´ ë²• ì·¨ì§€ì™€ ë‹¤ì†Œ ê±°ë¦¬ê°€ ìˆì–´ ë³´ì´ëŠ”ë°,
          'ì—…ë¬´ìƒ ì§€ì¥ì´ ìˆëŠ” ê²½ìš° ì‹œê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆë‹¤' ì •ë„ë¡œ ë¬¸êµ¬ë¥¼ ì™„í™”í•˜ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?"

[ì°¸ê³  ë²•ë ¹/í‘œì¤€ ê³„ì•½ ì„¹ì…˜ ì‘ì„± ê¸°ì¤€]
- ê° í•­ëª©ì€ ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¥´ì„¸ìš”:
  - "- **ë²•ë ¹ëª…/ë¬¸ì„œëª… + ì¡°ë¬¸ ë²ˆí˜¸(ê°€ëŠ¥í•œ ê²½ìš°)**:
     (1) ì¡°ë¬¸Â·ë¬¸ì„œì˜ í•µì‹¬ ì·¨ì§€ 1ì¤„
     (2) í˜„ì¬ ê³„ì•½ ì¡°í•­ê³¼ì˜ ê´€ê³„/ì¶©ëŒ ì—¬ë¶€ 1ì¤„"
- ë‹¨ìˆœ ë‚˜ì—´í˜• ì˜ˆì‹œëŠ” í”¼í•˜ì„¸ìš”:
  - (ë‚˜ìœ ì˜ˆ) "ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°, ì œ17ì¡°, í‘œì¤€ ê·¼ë¡œê³„ì•½ì„œ.pdf"
  - (ì¢‹ì€ ì˜ˆ)
    - "ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°(ì—°ì°¨ìœ ê¸‰íœ´ê°€): ì¼ì • ê¸°ê°„ ê·¼ë¡œí•œ ê·¼ë¡œìì—ê²Œ ì—°ì°¨íœ´ê°€ë¥¼ ë¶€ì—¬í•´ì•¼ í•œë‹¤ëŠ” ê·œì •ìœ¼ë¡œ, íšŒì‚¬ ì‚¬ì •ë§Œìœ¼ë¡œ ì—°ì°¨ ìì²´ë¥¼ ë¶€ì—¬í•˜ì§€ ì•ŠëŠ” ê²ƒì€ í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì—ì„œ í˜„ì¬ ì¡°í•­ê³¼ ì¶©ëŒ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤."

[ì–¸ì–´ ë° í˜•ì‹ ê·œì¹™]
- ëª¨ë“  ë‹µë³€ì€ ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•˜ì„¸ìš”.
- ì˜ì–´Â·ì¼ë³¸ì–´Â·ì¤‘êµ­ì–´ ë“± ë‹¤ë¥¸ ì–¸ì–´ë¥¼ ì„ì§€ ë§ˆì„¸ìš”(ë²•ë ¹ ëª…ì¹­ì˜ ê´€ìš©ì  í‘œê¸°ëŠ” ì˜ˆì™¸ì ìœ¼ë¡œ í—ˆìš©).
- ë‹µë³€ êµ¬ì¡°ëŠ” í•­ìƒ ì•„ë˜ í˜•ì‹ì„ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤.

[ìµœì¢… ì¶œë ¥ í˜•ì‹]

## ìš”ì•½ ê²°ë¡ 
- í•œë‘ ë¬¸ì¥ìœ¼ë¡œ í•µì‹¬ ê²°ë¡ ì„ ì •ë¦¬í•©ë‹ˆë‹¤.
- "ìœ„í—˜ë„: ê²½ë¯¸/ë³´í†µ/ë†’ìŒ" í˜•íƒœë¡œ ë¦¬ìŠ¤í¬ ë ˆë²¨ì„ ëª…ì‹œí•©ë‹ˆë‹¤.

## ì™œ ìœ„í—˜í•œì§€ (ë²•ì  ë¦¬ìŠ¤í¬)
- ì´ ì¡°í•­ì´ ì–´ë–¤ ì ì—ì„œ ë²•ë ¹Â·í‘œì¤€ê´€í–‰ê³¼ ì–´ê¸‹ë‚  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.
- ê·¼ë¡œê¸°ì¤€ë²•Â·ë¯¼ë²• ë“± ê´€ë ¨ ë²•ë ¹ì˜ "ì›ì¹™ vs ì˜ˆì™¸" êµ¬ì¡°ë¥¼ êµ¬ë¶„í•˜ì—¬ ì„¤ëª…í•©ë‹ˆë‹¤.
- ì‹¤ì œ ë¶„ìŸ ìƒí™©ì—ì„œ ë¬¸ì œë  ìˆ˜ ìˆëŠ” í¬ì¸íŠ¸(ì„ê¸ˆì²´ë¶ˆ, ì—°ì°¨ ë¯¸ë¶€ì—¬, ì†í•´ë°°ìƒ ì²­êµ¬ ê°€ëŠ¥ì„± ë“±)ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„œìˆ í•©ë‹ˆë‹¤.
- ë‹¤ë§Œ, ì‹¤ì œ ì‚¬ê±´ì— ëŒ€í•œ ìŠ¹ì†ŒÂ·íŒ¨ì†Œ ê°€ëŠ¥ì„±ì„ ë‹¨ì •ì ìœ¼ë¡œ ì˜ˆì¸¡í•˜ì§€ëŠ” ë§ˆì„¸ìš”.

## ì‹¤ë¬´ í˜‘ìƒ í¬ì¸íŠ¸
- ì‹¤ë¬´ì—ì„œ ì–´ë–»ê²Œ ìš”ì²­Â·ìˆ˜ì •Â·í˜‘ì˜í•˜ë©´ ì¢‹ì„ì§€ ì œì•ˆí•©ë‹ˆë‹¤.
- **ë°˜ë“œì‹œ ë‹¤ìŒ ë‘ ê°€ì§€ë¥¼ í¬í•¨í•˜ì„¸ìš”:**
  1) **ì¡°í•­ ìˆ˜ì • ì œì•ˆ ì˜ˆì‹œ**
     - ê³„ì•½ì„œ ì¡°í•­ì„ ì–´ë–»ê²Œ ë°”ê¾¸ë©´ ë³´ë‹¤ ë²• ì·¨ì§€ì— ë¶€í•©í•˜ëŠ”ì§€, ë¬¸ì¥ ì˜ˆì‹œ í˜•íƒœë¡œ ì œì•ˆí•˜ì„¸ìš”.
     - ê¸°ì¡´ ì¡°í•­ê³¼ ìˆ˜ì •ì•ˆì„ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ì œì‹œí•˜ì„¸ìš”.
     - ì˜ˆ: 
       - ê¸°ì¡´: "ì›”ê¸‰ 2,000,000ì›"
       - ìˆ˜ì •ì•ˆ: "ê¸°ë³¸ê¸‰: 1,800,000ì›, ê³ ì • ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹: 150,000ì›(ì›” 20ì‹œê°„ë¶„), ì‹ëŒ€Â·ê¸°íƒ€ ìˆ˜ë‹¹: 50,000ì›"
  
  2) **í˜‘ìƒÂ·ë¬¸ì˜ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ í‘œí˜„ ì˜ˆì‹œ**
     - ìƒëŒ€ë°©(íšŒì‚¬/ì¸ì‚¬ë‹´ë‹¹ì/ëŒ€í‘œ)ì—ê²Œ ì •ì¤‘í•˜ê²Œ ë¬¸ì˜Â·ìš”ì²­í•  ë•Œ ì“¸ ìˆ˜ ìˆëŠ” ë¬¸ì¥ì„ í•œêµ­ì–´ë¡œ 2~3ë¬¸ì¥ ì œì‹œí•˜ì„¸ìš”.
     - ì‚¬ìš©ìê°€ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ë©”ì¼/ëŒ€í™”ì— í™œìš©í•  ìˆ˜ ìˆì„ ì •ë„ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
     - ì˜ˆ:
       - "í˜„ì¬ ê³„ì•½ì„œì—ëŠ” 'ì›” 200ë§Œ ì›'ë§Œ ê¸°ì¬ë˜ì–´ ìˆëŠ”ë°, ë‚˜ì¤‘ì— í†µìƒì„ê¸ˆÂ·ì—°ì¥ìˆ˜ë‹¹Â·í‡´ì§ê¸ˆ ê³„ì‚° ì‹œ ê¸°ì¤€ì´ ì• ë§¤í•´ì§ˆ ìˆ˜ ìˆì–´ì„œìš”. ê¸°ë³¸ê¸‰Â·ìˆ˜ë‹¹Â·(ê³ ì •OTê°€ ìˆë‹¤ë©´) ê·¸ ë¶€ë¶„ì„ í•­ëª©ë³„ë¡œ ë‚˜ëˆ ì„œ ëª…ì‹œí•´ ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?"
       - "ì´ ê¸ˆì•¡ ì•ˆì— ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹ì´ ì–´ëŠ ì •ë„ê¹Œì§€ í¬í•¨ëœ ê²ƒì¸ì§€, ì•„ë‹ˆë©´ ë³„ë„ë¡œ ì§€ê¸‰ë˜ëŠ” êµ¬ì¡°ì¸ì§€ê°€ ê¶ê¸ˆí•©ë‹ˆë‹¤. í¬ê´„ì„ê¸ˆì œê°€ ì•„ë‹ˆë¼ë©´ 'ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ê·¼ë¡œëŠ” ì‹¤ì œ ë°œìƒ ì‹œê°„ì— ë”°ë¼ ë³„ë„ ì§€ê¸‰í•œë‹¤'ëŠ” ë¬¸êµ¬ë¥¼, í¬ê´„ì„ê¸ˆì œë¼ë©´ 'ì›” â—‹ì‹œê°„ë¶„ì˜ ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹ì´ í¬í•¨ëœë‹¤'ì²˜ëŸ¼ ë²”ìœ„ì™€ ê¸°ì¤€ì„ ê³„ì•½ì„œì— ê°™ì´ ì ì–´ì£¼ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤."
  
  3) **í˜„ì‹¤ì ì¸ íƒ€í˜‘ì•ˆ** (í•´ë‹¹ë˜ëŠ” ê²½ìš°)
     - ì‹œê¸° ì¡°ì •, ëŒ€ì²´íœ´ê°€, ìˆ˜ë‹¹ ì§€ê¸‰ ë“± êµ¬ì²´ì ì¸ ëŒ€ì•ˆì„ ì œì‹œí•˜ì„¸ìš”.

## ì°¸ê³  ë²•ë ¹/í‘œì¤€ ê³„ì•½
- **ë°˜ë“œì‹œ ìµœì†Œ 1ê°œ ì´ìƒì˜ êµ¬ì²´ì ì¸ ë²•ë ¹ì´ë‚˜ í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ ìœ í˜•ì„ ì–¸ê¸‰í•˜ì„¸ìš”.**
- ê´€ë ¨ ë²•ë ¹Â·ê°€ì´ë“œÂ·í‘œì¤€ê³„ì•½ì„œì˜ ì·¨ì§€ì™€, í˜„ì¬ ì¡°í•­ê³¼ì˜ ê´€ê³„ë¥¼ ìš”ì•½í•©ë‹ˆë‹¤.
- íŒŒì¼ëª…ë§Œ ë‚˜ì—´í•˜ì§€ ë§ê³ , ê° ë¬¸ì„œê°€ ì§€ê¸ˆ ì‚¬ì•ˆê³¼ ì–´ë–»ê²Œ ì—°ê²°ë˜ëŠ”ì§€ê¹Œì§€ í•œ ì¤„ì”© ì„¤ëª…í•©ë‹ˆë‹¤.
- í˜•ì‹: **ë²•ë ¹ëª…/ë¬¸ì„œëª… + ì¡°ë¬¸ ë²ˆí˜¸(ê°€ëŠ¥í•œ ê²½ìš°)**: (1) ì¡°ë¬¸Â·ë¬¸ì„œì˜ í•µì‹¬ ì·¨ì§€ 1ì¤„ (2) í˜„ì¬ ê³„ì•½ ì¡°í•­ê³¼ì˜ ê´€ê³„/ì¶©ëŒ ì—¬ë¶€ 1ì¤„
- ì˜ˆì‹œ:
  - **ê·¼ë¡œê¸°ì¤€ë²• ì œ17ì¡°(ê·¼ë¡œì¡°ê±´ì˜ ëª…ì‹œ)**: ì„ê¸ˆ, ì†Œì •ê·¼ë¡œì‹œê°„, íœ´ì¼ ë“± ì£¼ìš” ê·¼ë¡œì¡°ê±´ì„ ì„œë©´ìœ¼ë¡œ ëª…í™•íˆ ì ì‹œí•´ì•¼ í•œë‹¤ëŠ” ê·œì •ì…ë‹ˆë‹¤. "ì›”ê¸‰ 200ë§Œ ì›"ë§Œ ìˆê³  êµ¬ì„±ì´ ì•ˆ ë‚˜ëˆ ì ¸ ìˆìœ¼ë©´ ë²•ì´ ìš”êµ¬í•˜ëŠ” ìˆ˜ì¤€ì˜ 'êµ¬ì²´ì Â·ëª…í™•í•œ ê·¼ë¡œì¡°ê±´ ëª…ì‹œ'ë¡œ ë³´ê¸° ì–´ë µìŠµë‹ˆë‹¤.
  - **ê·¼ë¡œê¸°ì¤€ë²• ì œ43ì¡°(ì„ê¸ˆ ì§€ê¸‰ ì›ì¹™)**: ì„ê¸ˆì„ ë§¤ì›” 1íšŒ ì´ìƒ, ì¼ì •í•œ ë‚ ì§œì— ì „ì•¡ ì§€ê¸‰í•  ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤. ì„ê¸ˆ êµ¬ì„±ì´ ë¶ˆëª…í™•í•˜ë©´ ì§€ê¸‰ ì‹œê¸°ì™€ ë°©ë²•ì„ ëª…í™•íˆ í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.

---
â€» ì´ ë‹µë³€ì€ ì •ë³´ ì œê³µì„ ìœ„í•œ ì¼ë°˜ì ì¸ ì•ˆë‚´ì´ë©°, ê°œë³„ ì‚¬ê±´ì— ëŒ€í•œ ë²•ë¥  ìë¬¸ì´ ì•„ë‹™ë‹ˆë‹¤.
ì¤‘ìš”í•œ ì˜ì‚¬ê²°ì •ì´ë‚˜ ë¶„ìŸ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì‚¬ì•ˆì˜ ê²½ìš°, ë°˜ë“œì‹œ ë³€í˜¸ì‚¬Â·ë…¸ë¬´ì‚¬ ë“± ì „ë¬¸ ìê²©ìë¥¼ í†µí•´ êµ¬ì²´ì ì¸ ìƒë‹´ì„ ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
"""


def _get_category_rules(category: Optional[str]) -> str:
    """
    ê³„ì•½ì„œ ì´ìŠˆ ì¹´í…Œê³ ë¦¬ë³„ë¡œ LLMì—ê²Œ ì¤„ ì¶”ê°€ ì§€ì¹¨.
    í”„ë¡ íŠ¸ì—ì„œ ë„˜ê²¨ì£¼ëŠ” selected_issue.category ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë§¤ì¹­.
    
    Args:
        category: ì´ìŠˆ ì¹´í…Œê³ ë¦¬ (ì˜ˆ: "pay", "working_hours", "termination" ë“±)
    
    Returns:
        ì¹´í…Œê³ ë¦¬ë³„ ì¶”ê°€ ì§€ì¹¨ ë¬¸ìì—´ (ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
    """
    if not category:
        return ""
    
    # í†µì¼ëœ í‚¤ë¡œ ë§ì¶°ë‘ê¸° (í”„ë¡ íŠ¸/ë°±ì—”ë“œ ê³µí†µ)
    cat = str(category).lower().strip()
    
    # 1) ë³´ìˆ˜Â·ìˆ˜ë‹¹ / ì„ê¸ˆ
    if cat in {"pay", "wage", "salary", "ë³´ìˆ˜", "ì„ê¸ˆ", "ìˆ˜ë‹¹", "unpaid_wage"}:
        return """
[ì¹´í…Œê³ ë¦¬: ë³´ìˆ˜Â·ìˆ˜ë‹¹ ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìµœìš°ì„ ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) ì„ê¸ˆ êµ¬ì„±(ê¸°ë³¸ê¸‰/ê°ì¢… ìˆ˜ë‹¹/ì„±ê³¼ê¸‰)ì´ ëª…í™•í•˜ê²Œ êµ¬ë¶„ë˜ì–´ ìˆëŠ”ì§€
  2) ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œìˆ˜ë‹¹ì´ ë³„ë„ë¡œ ì§€ê¸‰ë˜ëŠ”ì§€,
     ì•„ë‹ˆë©´ ì—°ë´‰Â·í¬ê´„ì„ê¸ˆì— í¬í•¨ëœë‹¤ê³  ë˜ì–´ ìˆëŠ”ì§€
  3) ì„ê¸ˆ ì§€ê¸‰ ì‹œê¸°Â·ë°©ë²•ì´ ëª…í™•í•œì§€ (ë§¤ì›” 1íšŒ ì´ìƒ, ì •í•´ì§„ ì§€ê¸‰ì¼ ë“±)
  4) ìµœì €ì„ê¸ˆ ì´ìƒì´ ë³´ì¥ë˜ëŠ” êµ¬ì¡°ì¸ì§€
  5) ì†Œì •ê·¼ë¡œì‹œê°„(ì£¼ 40ì‹œê°„ ë“±)ì´ ëª…ì‹œë˜ì–´ ìˆëŠ”ì§€

- ìœ„í—˜ë„ í‰ê°€ ë°©ì‹:
  * ë‹¨ìˆœíˆ "ìœ„ë°˜ìœ¼ë¡œ íŒë‹¨ë  ìˆ˜ ìˆë‹¤"ê³  ë§í•˜ê¸°ë³´ë‹¤ëŠ”,
    "ì •ë³´ê°€ ë¶€ì¡±í•´ì„œ ë‚˜ì¤‘ì— íšŒì‚¬ ìª½ì— ìœ ë¦¬í•˜ê²Œ í•´ì„ë  ì—¬ì§€ê°€ ë§¤ìš° í¬ë‹¤"ëŠ” ì ì„ ê°•ì¡°í•˜ì„¸ìš”.
  * ì˜ˆ: "ì›”ê¸‰ 200ë§Œ ì›"ë§Œ ìˆê³  êµ¬ì„±ì´ ëª…ì‹œë˜ì§€ ì•Šìœ¼ë©´,
    ë‚˜ì¤‘ì— íšŒì‚¬ê°€ "ì—¬ê¸°ì— ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ìˆ˜ë‹¹, ì‹ëŒ€, ê°ì¢… ìˆ˜ë‹¹ì´ ë‹¤ í¬í•¨ë˜ì–´ ìˆë‹¤"ê³  ì£¼ì¥í•  ë•Œ
    ê·¼ë¡œìê°€ ë°˜ë°•í•˜ê¸° ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.
  * í†µìƒì„ê¸ˆÂ·í‰ê· ì„ê¸ˆ ì‚°ì •, í‡´ì§ê¸ˆÂ·ì—°ì°¨ìˆ˜ë‹¹ ê³„ì‚° ì‹œì—ë„ ê¸°ì¤€ì´ ì• ë§¤í•´ì ¸ ë¶„ìŸ ì†Œì§€ê°€ í½ë‹ˆë‹¤.

- ê´€ë ¨ ë²•ë ¹ ì˜ˆì‹œ:
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ17ì¡°(ê·¼ë¡œì¡°ê±´ì˜ ëª…ì‹œ): ì„ê¸ˆ, ì†Œì •ê·¼ë¡œì‹œê°„, íœ´ì¼, ì—°ì°¨ ë“± ì£¼ìš” ê·¼ë¡œì¡°ê±´ì„ ì„œë©´ìœ¼ë¡œ ëª…í™•íˆ ì ì‹œí•´ì•¼ í•¨.
    "ì›”ê¸‰ 200ë§Œ ì›"ë§Œ ìˆê³  êµ¬ì„±ì´ ì•ˆ ë‚˜ëˆ ì ¸ ìˆìœ¼ë©´ ë²•ì´ ìš”êµ¬í•˜ëŠ” ìˆ˜ì¤€ì˜ 'êµ¬ì²´ì Â·ëª…í™•í•œ ê·¼ë¡œì¡°ê±´ ëª…ì‹œ'ë¡œ ë³´ê¸° ì–´ë µìŠµë‹ˆë‹¤.
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ43ì¡°: ì„ê¸ˆì˜ ì§ì ‘Â·ì „ì•¡Â·ì •ê¸° ì§€ê¸‰ ì›ì¹™
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ56ì¡°: ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œì— ëŒ€í•œ ê°€ì‚°ìˆ˜ë‹¹ ê·œì •
  * ìµœì €ì„ê¸ˆë²•: ìµœì €ì„ê¸ˆ ë³´ì¥ ê·œì •

- ë²• ì¡°í•­ ì¸ìš© ì‹œ ì£¼ì˜ì‚¬í•­:
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ17ì¡°ëŠ” "ê·¼ë¡œì¡°ê±´ì˜ ëª…ì‹œ ì˜ë¬´" ì¡°í•­ì´ë¯€ë¡œ, ì„ê¸ˆ êµ¬ì„±ì´ ë¶ˆëª…í™•í•œ ê²½ìš°ì— ì ì ˆíˆ ì¸ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  * ì„ê¸ˆ ì§€ê¸‰ ê´€ë ¨í•´ì„œëŠ” ì œ43ì¡°, ì—°ì¥ê·¼ë¡œ ìˆ˜ë‹¹ ê´€ë ¨í•´ì„œëŠ” ì œ56ì¡°ë¥¼ ì •í™•íˆ ì¸ìš©í•˜ì„¸ìš”.
"""
    
    # 2) ê·¼ë¡œì‹œê°„ / ì—°ì¥Â·ì•¼ê°„ê·¼ë¡œ
    if cat in {"working_hours", "hours", "ê·¼ë¡œì‹œê°„", "ì—°ì¥ê·¼ë¡œ", "ì•¼ê°„ê·¼ë¡œ", "ì•¼ê·¼", "overtime"}:
        return """
[ì¹´í…Œê³ ë¦¬: ê·¼ë¡œì‹œê°„Â·ì—°ì¥ê·¼ë¡œ ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) 1ì¼Â·1ì£¼ ê¸°ì¤€ ê·¼ë¡œì‹œê°„ì´ ì–´ë–»ê²Œ ì •í•´ì ¸ ìˆëŠ”ì§€
  2) ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ê·¼ë¡œë¥¼ ì–¼ë§ˆë‚˜ ì‹œí‚¬ ìˆ˜ ìˆë‹¤ê³  ë˜ì–´ ìˆëŠ”ì§€
  3) í¬ê´„ì ìœ¼ë¡œ 'íšŒì‚¬ í•„ìš” ì‹œ ì¶”ê°€ ê·¼ë¡œ'ë§Œ ê·œì •í•˜ê³  ìˆëŠ”ì§€,
     ì•„ë‹ˆë©´ ìƒí•œÂ·ë™ì˜ ì ˆì°¨ê°€ ëª…ì‹œë˜ì–´ ìˆëŠ”ì§€
  4) íœ´ê²Œì‹œê°„Â·íœ´ì¼ ë³´ì¥ì´ ì–´ë–»ê²Œ ë˜ì–´ ìˆëŠ”ì§€
  5) ì—°ì°¨ìœ ê¸‰íœ´ê°€ ë¶€ì—¬Â·ì‚¬ìš©ê³¼ ê´€ë ¨ëœ ì¡°í•­ì´ ìˆëŠ”ì§€

- ì„¤ëª… ì‹œì—ëŠ”:
  * ì‹¤ì œë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¥ì‹œê°„ ê·¼ë¡œ, íœ´ê²ŒÂ·íœ´ì¼ ë¯¸ë³´ì¥, ê³¼ë¡œ ë¦¬ìŠ¤í¬ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ
    ê·¼ë¡œìì˜ ê±´ê°•ê¶ŒÂ·ìƒí™œê¶Œ ì¸¡ë©´ì˜ ìœ„í—˜ì„±ì„ í•¨ê»˜ ì„¤ëª…í•˜ì„¸ìš”.
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ50ì¡°(ê·¼ë¡œì‹œê°„), ì œ53ì¡°(ì—°ì¥ê·¼ë¡œ), ì œ56ì¡°(ê°€ì‚°ìˆ˜ë‹¹)ì„ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì„¸ìš”.
  * ì£¼ 40ì‹œê°„, ì£¼ 12ì‹œê°„ ì—°ì¥ê·¼ë¡œ í•œë„ ë“±ì„ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì„¸ìš”.
  * ì—°ì°¨Â·íœ´ê°€ ê´€ë ¨ ì¡°í•­ì´ í¬í•¨ëœ ê²½ìš°:
    - ì—°ì°¨ìœ ê¸‰íœ´ê°€ëŠ” ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°ì—ì„œ ê°•í–‰ê·œì •ìœ¼ë¡œ ë³´ì¥í•œ ê¶Œë¦¬ì…ë‹ˆë‹¤.
    - "íšŒì‚¬ ì‚¬ì •ì— ë”°ë¼ ë¶€ì—¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤"ëŠ” ì‹ì˜ í‘œí˜„ì€ í•´ë‹¹ ë¶€ë¶„ì´ ë¬´íš¨ë¡œ íŒë‹¨ë  ì—¬ì§€ê°€ í½ë‹ˆë‹¤.
    - íšŒì‚¬ëŠ” ì—°ì°¨ ë¶€ì—¬ ìì²´ë¥¼ ê±°ë¶€í•  ìˆ˜ ì—†ìœ¼ë©°, ë‹¤ë§Œ ì‚¬ìš© ì‹œê¸°(ì‹œê¸° ë³€ê²½ê¶Œ)ë§Œ ì—…ë¬´ìƒ í•„ìš”ì— ë”°ë¼ ë³€ê²½ ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
"""
    
    # 2-1) ì—°ì°¨Â·íœ´ê°€ (working_hoursì™€ ìœ ì‚¬í•˜ì§€ë§Œ ë³„ë„ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¦¬)
    if cat in {"leave", "vacation", "ì—°ì°¨", "íœ´ê°€", "ì—°ì°¨íœ´ê°€", "ìœ ê¸‰íœ´ê°€"}:
        return """
[ì¹´í…Œê³ ë¦¬: ì—°ì°¨Â·íœ´ê°€ ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) ì—°ì°¨ìœ ê¸‰íœ´ê°€ ë¶€ì—¬ ìì²´ë¥¼ íšŒì‚¬ê°€ ì„ì˜ë¡œ ë°°ì œí•  ìˆ˜ ìˆë„ë¡ ê·œì •ë˜ì–´ ìˆëŠ”ì§€
  2) ì—°ì°¨ ì‚¬ìš© ì‹œê¸° ë³€ê²½ê¶Œ(íšŒì‚¬ ìš”ì²­)ê³¼ ì—°ì°¨ ë¶€ì—¬ ê±°ë¶€ë¥¼ êµ¬ë¶„í•˜ì—¬ ê·œì •í•˜ê³  ìˆëŠ”ì§€
  3) ì‚¬ìš©í•˜ì§€ ëª»í•œ ì—°ì°¨ì— ëŒ€í•œ ì •ì‚°(ìˆ˜ë‹¹ ì§€ê¸‰) ê¸°ì¤€ì´ ëª…í™•í•œì§€
  4) ì—°ì°¨ ë¶€ì—¬ ìš”ê±´(ê·¼ì† ê¸°ê°„ ë“±)ì´ ë²•ì • ê¸°ì¤€ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€

- ì„¤ëª… ì‹œì—ëŠ”:
  * ì—°ì°¨ìœ ê¸‰íœ´ê°€ëŠ” ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°ì—ì„œ ê°•í–‰ê·œì •ìœ¼ë¡œ ë³´ì¥í•œ ê¶Œë¦¬ì…ë‹ˆë‹¤.
    "íšŒì‚¬ ì‚¬ì •ì— ë”°ë¼ ë¶€ì—¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤"ëŠ” ì‹ì˜ í‘œí˜„ì€ í•´ë‹¹ ë¶€ë¶„ì´ ë¬´íš¨ë¡œ íŒë‹¨ë  ì—¬ì§€ê°€ í½ë‹ˆë‹¤.
  * íšŒì‚¬ëŠ” ì—°ì°¨ ë¶€ì—¬ ìì²´ë¥¼ ê±°ë¶€í•  ìˆ˜ ì—†ìœ¼ë©°, ë‹¤ë§Œ ì‚¬ìš© ì‹œê¸°(ì‹œê¸° ë³€ê²½ê¶Œ)ë§Œ ì—…ë¬´ìƒ í•„ìš”ì— ë”°ë¼ ë³€ê²½ ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  * ê°•í–‰ê·œì • ìœ„ë°˜ ì†Œì§€ê°€ ìˆëŠ” ê²½ìš°ì—ëŠ” "ê³„ì•½ì„œì— ì´ë ‡ê²Œ ì¨ ìˆì–´ë„ ê·¸ ë¶€ë¶„ì€ ë¬´íš¨ë¡œ íŒë‹¨ë  ì—¬ì§€ê°€ í½ë‹ˆë‹¤"ê¹Œì§€ ëª…ì‹œí•˜ì„¸ìš”.
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°(ì—°ì°¨ìœ ê¸‰íœ´ê°€)ë¥¼ ì •í™•íˆ ì¸ìš©í•˜ì„¸ìš”.
"""
    
    # 3) í•´ì§€Â·í•´ê³ Â·ì§•ê³„
    if cat in {"termination", "dismissal", "í•´ì§€", "í•´ê³ ", "ì§•ê³„", "probation"}:
        return """
[ì¹´í…Œê³ ë¦¬: ê³„ì•½ í•´ì§€Â·í•´ê³ Â·ì§•ê³„ ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) ì‚¬ìš©ìê°€ ì„ì˜ë¡œ ê³„ì•½ì„ í•´ì§€í•˜ê±°ë‚˜ í•´ê³ í•  ìˆ˜ ìˆëŠ” ì‚¬ìœ ê°€
     êµ¬ì²´ì ìœ¼ë¡œ ì—´ê±°ë˜ì–´ ìˆëŠ”ì§€, ì•„ë‹ˆë©´ 'íšŒì‚¬ íŒë‹¨'ì²˜ëŸ¼ í¬ê´„ì ìœ¼ë¡œ ë˜ì–´ ìˆëŠ”ì§€
  2) í•´ê³ Â·ì§•ê³„ ì ˆì°¨(ì‚¬ì „ í†µì§€, ì†Œëª… ê¸°íšŒ ë“±)ê°€ ê·œì •ë˜ì–´ ìˆëŠ”ì§€
  3) í•´ì§€ ì˜ˆê³  ê¸°ê°„, í•´ì§€ ì‹œ ë³´ìƒÂ·ì •ì‚° ë°©ì‹(í‡´ì§ê¸ˆ, ë¯¸ì§€ê¸‰ ì„ê¸ˆ ë“±)ì´ ì •í•´ì ¸ ìˆëŠ”ì§€
  4) ì‹œìš©ê¸°ê°„(ìˆ˜ìŠµ) ì¤‘ í•´ì§€ì™€ ê´€ë ¨ëœ ì¡°í•­ì´ ê³¼ë„í•˜ê²Œ íšŒì‚¬ì— ìœ ë¦¬í•˜ì§€ ì•Šì€ì§€

- ì„¤ëª… ì‹œì—ëŠ”:
  * ê·¼ë¡œê¸°ì¤€ë²•ìƒ í•´ê³  ì œí•œÂ·í•´ê³  ì ˆì°¨ ê´€ë ¨ ê·œì •ì„ ê·¼ê±°ë¡œ,
    'ì‚¬ìœ ê°€ ë¶ˆëª…í™•í•˜ê±°ë‚˜ ì ˆì°¨ê°€ ì—†ëŠ” ì¡°í•­'ì´ ì™œ ë¶„ìŸ ìœ„í—˜ì´ í°ì§€ ê°•ì¡°í•˜ì„¸ìš”.
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ27ì¡°(í•´ê³ ì˜ ì œí•œ), ì œ28ì¡°(í•´ê³  ì˜ˆê³ )ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì„¸ìš”.
  * ìì˜ì  í•´ì§€ ê¸ˆì§€ ì›ì¹™ì„ ëª…í™•íˆ ì„¤ëª…í•˜ì„¸ìš”.
"""
    
    # 4) ê²½ì—…ê¸ˆì§€ / ê²¸ì—… ì œí•œ
    if cat in {"non_compete", "competition", "ê²½ì—…ê¸ˆì§€", "ê²¸ì—…ì œí•œ"}:
        return """
[ì¹´í…Œê³ ë¦¬: ê²½ì—…ê¸ˆì§€Â·ê²¸ì—… ì œí•œ ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) ê²½ì—…ê¸ˆì§€ ê¸°ê°„ì´ ì–´ëŠ ì •ë„ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ (ì˜ˆ: í‡´ì§ í›„ ëª‡ ë…„ ë“±)
  2) ê²½ì—…ê¸ˆì§€ì˜ ë²”ìœ„(ë™ì¢… ì—…ì¢…Â·ë™ì¼ ì§ë¬´Â·íŠ¹ì • ê²½ìŸì‚¬ ë“±)ê°€ ì–¼ë§ˆë‚˜ ë„“ê²Œ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€
  3) ì ìš© ì§€ì—­(êµ­ë‚´ ì „ì²´, íŠ¹ì • ì§€ì—­ ë“±)ì´ ì§€ë‚˜ì¹˜ê²Œ ë„“ì§€ ì•Šì€ì§€
  4) ê²½ì—…ê¸ˆì§€ì— ëŒ€í•œ ëŒ€ê°€(ì¶”ê°€ ë³´ìƒ, ë³„ë„ì˜ ìˆ˜ë‹¹ ë“±)ê°€ ìˆëŠ”ì§€

- ì„¤ëª… ì‹œì—ëŠ”:
  * ì§ì—… ì„ íƒì˜ ììœ , ìƒê³„ ìœ ì§€ ê°€ëŠ¥ì„± ê´€ì ì—ì„œ ê³¼ë„í•œ ë²”ìœ„Â·ê¸°ê°„Â·ëŒ€ê°€ ë¶€ì¬ê°€
    ì–´ë–¤ ë¦¬ìŠ¤í¬ë¥¼ ê°€ì§€ëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.
  * ê²½ì—…ê¸ˆì§€ ì¡°í•­ì˜ í•©ë¦¬ì„± íŒë‹¨ ê¸°ì¤€(ê¸°ê°„, ë²”ìœ„, ì§€ì—­, ëŒ€ê°€)ì„ ëª…í™•íˆ ì œì‹œí•˜ì„¸ìš”.
"""
    
    # 5) ë¹„ë°€ìœ ì§€Â·NDA
    if cat in {"nda", "confidentiality", "ë¹„ë°€ìœ ì§€", "ê¸°ë°€ìœ ì§€"}:
        return """
[ì¹´í…Œê³ ë¦¬: ë¹„ë°€ìœ ì§€Â·NDA ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) 'ë¹„ë°€ì •ë³´'ì˜ ë²”ìœ„ê°€ ë„ˆë¬´ í¬ê´„ì ìœ¼ë¡œ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì€ì§€
     (ì´ë¯¸ ê³µê°œëœ ì •ë³´, ì¼ë°˜ì ì¸ ì§ë¬´ ì§€ì‹ê¹Œì§€ í¬í•¨í•˜ëŠ”ì§€ ì—¬ë¶€)
  2) ë¹„ë°€ìœ ì§€ ì˜ë¬´ê°€ ì–¸ì œê¹Œì§€ ìœ ì§€ë˜ëŠ”ì§€ (ì¬ì§ ì¤‘/í‡´ì§ í›„ ëª‡ ë…„ ë“±)
  3) ìœ„ë°˜ ì‹œ ì†í•´ë°°ìƒ ì±…ì„ì´ êµ¬ì²´ì ì¸ì§€, ê³¼ë„í•œ ìœ„ì•½ë²ŒÂ·ì†í•´ì¶”ì • ì¡°í•­ì´ ì—†ëŠ”ì§€
  4) ê·¼ë¡œìì˜ ì •ìƒì ì¸ ì´ì§Â·ê²½ë ¥ ê¸°ìˆ ê¹Œì§€ ì œí•œí•  ì†Œì§€ê°€ ìˆëŠ”ì§€

- ì„¤ëª… ì‹œì—ëŠ”:
  * íšŒì‚¬ì˜ ì •ë‹¹í•œ ì´ìµ ë³´í˜¸ì™€ ê·¼ë¡œìì˜ ì •ìƒì ì¸ ê²½ë ¥ ê´€ë¦¬ê°€ ê· í˜•ì„ ì´ë¤„ì•¼ í•œë‹¤ëŠ” ì ì„
    ê¸°ì¤€ìœ¼ë¡œ ê³¼ë„í•œ ë¶€ë¶„ì´ ìˆëŠ”ì§€ ì§šì–´ì£¼ì„¸ìš”.
  * ë¹„ë°€ì •ë³´ì˜ ë²”ìœ„ê°€ ì§€ë‚˜ì¹˜ê²Œ ë„“ê±°ë‚˜, í‡´ì§ í›„ ì˜ë¬´ ê¸°ê°„ì´ ê³¼ë„í•œ ê²½ìš°ì˜ ë¬¸ì œì ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.
"""
    
    # 6) ì €ì‘ê¶ŒÂ·ì§€ì ì¬ì‚°ê¶Œ
    if cat in {"ip", "copyright", "ì €ì‘ê¶Œ", "ì§€ì ì¬ì‚°ê¶Œ", "intellectual_property"}:
        return """
[ì¹´í…Œê³ ë¦¬: ì €ì‘ê¶ŒÂ·ì§€ì ì¬ì‚°ê¶Œ ê´€ë ¨ ì¡°í•­]

- ì•„ë˜ ì‚¬í•­ì„ ìš°ì„ ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì„¤ëª…í•˜ì„¸ìš”:
  1) ì—…ë¬´ìƒ ì‘ì„±í•œ ì €ì‘ë¬¼(ì§ë¬´ì €ì‘ë¬¼)ì— í•œí•´ íšŒì‚¬ì— ê·€ì†ë˜ëŠ”ì§€,
     ì•„ë‹ˆë©´ ê·¼ë¡œìì˜ ê°œì¸ ì°½ì‘ë¬¼ê¹Œì§€ í¬ê´„í•˜ëŠ”ì§€
  2) 2ì°¨ì  ì €ì‘ë¬¼ ì‘ì„±ê¶Œê¹Œì§€ ëª¨ë‘ íšŒì‚¬ì— ê·€ì†ì‹œí‚¤ëŠ”ì§€
  3) ì—…ë¬´ ì™¸ ê°œì¸ í”„ë¡œì íŠ¸, í¬íŠ¸í´ë¦¬ì˜¤ í™œìš© ê°€ëŠ¥ ì—¬ë¶€ê°€ ì œí•œë˜ëŠ”ì§€
  4) ì¬ì§ ì¤‘Â·í‡´ì‚¬ í›„ ëª¨ë‘ ì ìš©ë˜ëŠ”ì§€ ë° ê¸°ê°„ì´ ê³¼ë„í•˜ì§€ ì•Šì€ì§€

- ì„¤ëª… ì‹œì—ëŠ”:
  * íšŒì‚¬ì˜ ì •ë‹¹í•œ IP í™•ë³´ì™€, ê·¼ë¡œìì˜ ê²½ë ¥ ê°œë°œÂ·í¬íŠ¸í´ë¦¬ì˜¤ ì‘ì„± ê¶Œë¦¬ ì‚¬ì´ì˜
    ê· í˜• ì¸¡ë©´ì—ì„œ ì–´ë–¤ ë¬¸ì œê°€ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.
  * ì €ì‘ê¶Œë²• ì œ2ì¡°(ì €ì‘ë¬¼ì˜ ì •ì˜), ì œ9ì¡°(ì§ë¬´ì €ì‘ë¬¼ì˜ ì €ì‘ì)ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì„¸ìš”.
  * ì—…ë¬´ìƒ ì €ì‘ë¬¼ê³¼ ê°œì¸ ì°½ì‘ë¬¼ì˜ êµ¬ë¶„ ê¸°ì¤€ì„ ëª…í™•íˆ ì„¤ëª…í•˜ì„¸ìš”.
"""
    
    # ë§¤ì¹­ ì•ˆ ë˜ë©´ ì•„ë¬´ ê²ƒë„ ì¶”ê°€ ì•ˆ í•¨
    return ""


def build_legal_chat_prompt(
    query: str,
    contract_chunks: list = None,
    legal_chunks: list = None,
    selected_issue: dict = None,
    analysis_summary: str = None,
    risk_score: int = None,
    total_issues: int = None,
) -> str:
    """
    ë²•ë¥  ìƒë‹´ ì±—ìš© í”„ë¡¬í”„íŠ¸ êµ¬ì„± (ê°œì„  ë²„ì „)
    - ë¬¸ì œë˜ëŠ” ì¡°í•­ ì›ë¬¸ ì§ì ‘ ì¸ìš©
    - ì¹´í…Œê³ ë¦¬ë³„ íŠ¹ë³„ ê·œì¹™ ì ìš©
    - ì‹¤ë¬´ í˜‘ìƒ í¬ì¸íŠ¸ êµ¬ì²´í™”
    
    Args:
        query: ì‚¬ìš©ì ì§ˆë¬¸
        contract_chunks: ê³„ì•½ì„œ ë‚´ë¶€ ì²­í¬
        legal_chunks: ë²•ë ¹ ì²­í¬
        selected_issue: ì„ íƒëœ ì´ìŠˆ ì •ë³´
        analysis_summary: ë¶„ì„ ìš”ì•½
        risk_score: ìœ„í—˜ë„ ì ìˆ˜
        total_issues: ì „ì²´ ì´ìŠˆ ê°œìˆ˜
    
    Returns:
        ì™„ì„±ëœ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´
    """
    context_parts = []
    
    # -----------------------------
    # 1) ë¬¸ì œë˜ëŠ” ì¡°í•­ ì›ë¬¸ ë¨¼ì € ë³´ì—¬ì£¼ê¸°
    # -----------------------------
    issue_article_num = None
    if selected_issue:
        # article_number ë˜ëŠ” articleNumber ì§€ì›
        issue_article_num = (
            selected_issue.get("article_number")
            or selected_issue.get("articleNumber")
        )
        # location.clauseNumberë„ í™•ì¸
        if not issue_article_num and selected_issue.get("location"):
            location = selected_issue.get("location")
            if isinstance(location, dict):
                issue_article_num = location.get("clauseNumber")
    
    picked_clause_chunks: list = []
    
    if contract_chunks:
        # ì„ íƒëœ ì´ìŠˆì˜ ì¡°í•­ ë²ˆí˜¸ì™€ ë§¤ì¹­ë˜ëŠ” chunk ìš°ì„  ì„ íƒ
        if issue_article_num is not None:
            issue_article_str = str(issue_article_num).strip()
            for ch in contract_chunks:
                chunk_article = str(ch.get("article_number", "")).strip()
                if chunk_article == issue_article_str:
                    picked_clause_chunks.append(ch)
                    break
        
        # ëª» ì°¾ìœ¼ë©´ ìƒìœ„ 1ê°œë¼ë„ ì‚¬ìš©
        if not picked_clause_chunks and len(contract_chunks) > 0:
            picked_clause_chunks.append(contract_chunks[0])
        
        if picked_clause_chunks:
            context_parts.append("=== ë¬¸ì œë˜ëŠ” ì¡°í•­ ì›ë¬¸(ì¼ë¶€) ===")
            for chunk in picked_clause_chunks[:1]:
                article_num = chunk.get("article_number", "")
                content = chunk.get("content", "")[:400]
                context_parts.append(
                    f"ì œ{article_num}ì¡° (ì¼ë¶€):\n\"{content}\""
                )
    
    # -----------------------------
    # 2) ê³„ì•½ì„œ ë‚´ìš© ì „ì²´ ì»¨í…ìŠ¤íŠ¸ (ìƒìœ„ 3ê°œ)
    # -----------------------------
    if contract_chunks:
        context_parts.append("=== ê³„ì•½ì„œ ê´€ë ¨ ì¡°í•­(ìš”ì•½) ===")
        for chunk in contract_chunks[:3]:
            article_num = chunk.get("article_number", "")
            content = chunk.get("content", "")[:500]
            context_parts.append(f"ì œ{article_num}ì¡°:\n{content}")
    
    # -----------------------------
    # 3) ë²•ë ¹ ì²­í¬
    # -----------------------------
    if legal_chunks:
        context_parts.append("\n=== ê´€ë ¨ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ ===")
        for chunk in legal_chunks[:5]:
            # LegalGroundingChunkëŠ” Pydantic ëª¨ë¸ì´ë¯€ë¡œ getattr ì‚¬ìš©
            source_type = getattr(chunk, 'source_type', 'law')
            title = getattr(chunk, 'title', '')
            snippet = getattr(chunk, 'snippet', getattr(chunk, 'content', ''))[:500]
            context_parts.append(f"[{source_type}] {title}\n{snippet}")
    
    context = "\n\n".join(context_parts)
    
    # -----------------------------
    # 4) ì„ íƒëœ ì´ìŠˆ ì •ë³´
    # -----------------------------
    issue_context = ""
    if selected_issue:
        # legalBasis ì²˜ë¦¬: string[] ë˜ëŠ” LegalBasisItemV2[] í˜•ì‹ ëª¨ë‘ ì§€ì›
        legal_basis_raw = selected_issue.get('legalBasis', [])
        logger.debug(f"[prompt] selected_issue.legalBasis íƒ€ì…: {[type(x).__name__ for x in legal_basis_raw]}")
        logger.debug(f"[prompt] selected_issue.legalBasis ìƒ˜í”Œ: {legal_basis_raw[:2] if legal_basis_raw else 'ì—†ìŒ'}")
        
        legal_basis_list = legal_basis_raw
        legal_basis_texts = []
        for basis in legal_basis_list[:3]:
            try:
                if isinstance(basis, dict):
                    # LegalBasisItemV2 í˜•ì‹: { title, snippet, sourceType }
                    title = basis.get('title', '')
                    snippet = basis.get('snippet', '')
                    legal_basis_texts.append(title or snippet or str(basis))
                elif isinstance(basis, str):
                    # string í˜•ì‹
                    legal_basis_texts.append(basis)
                else:
                    # ê¸°íƒ€ í˜•ì‹ì€ ë¬¸ìì—´ë¡œ ë³€í™˜
                    legal_basis_texts.append(str(basis))
            except Exception as basis_err:
                logger.warning(f"[prompt] legalBasis í•­ëª© ë³€í™˜ ì‹¤íŒ¨: {str(basis_err)}, basis={basis}")
                legal_basis_texts.append(str(basis) if basis else 'ì•Œ ìˆ˜ ì—†ìŒ')
        
        legal_basis_str = ', '.join(legal_basis_texts) if legal_basis_texts else 'ì—†ìŒ'
        logger.debug(f"[prompt] legalBasis ë³€í™˜ ê²°ê³¼: {legal_basis_str}")
        
        issue_context = f"""
**ì„ íƒëœ ìœ„í—˜ ì¡°í•­ ì •ë³´:**
- ì¹´í…Œê³ ë¦¬: {selected_issue.get('category', 'ì•Œ ìˆ˜ ì—†ìŒ')}
- ìš”ì•½: {selected_issue.get('summary', '')}
- ìœ„í—˜ë„: {selected_issue.get('severity', 'medium')}
- ì¡°í•­ ë‚´ìš©: {selected_issue.get('originalText', '')[:500]}
- ê´€ë ¨ ë²•ë ¹: {legal_basis_str}
"""
    
    # -----------------------------
    # 5) ì „ì²´ ë¶„ì„ ìš”ì•½ (ìƒí™© ë¶„ì„ ê²°ê³¼ ì»¨í…ìŠ¤íŠ¸)
    # -----------------------------
    analysis_context = ""
    if analysis_summary:
        # ìƒí™© ë¶„ì„ ê²°ê³¼ê°€ í¬í•¨ëœ ê²½ìš° ë” ëª…í™•í•˜ê²Œ í‘œì‹œ
        analysis_context = f"""
**ìƒí™© ë¶„ì„ ê²°ê³¼ (í˜„ì¬ í™”ë©´ì— í‘œì‹œëœ ë¶„ì„ ê²°ê³¼):**

{analysis_summary}

**ì¤‘ìš”:** ìœ„ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”. ì‚¬ìš©ìëŠ” ì´ë¯¸ ì´ ë¶„ì„ ê²°ê³¼ë¥¼ ë³´ê³  ìˆìœ¼ë©°, ì´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´í•´í•˜ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.
"""
    if risk_score is not None:
        analysis_context += f"\n**ì „ì²´ ìœ„í—˜ë„:** {risk_score}ì "
    if total_issues is not None:
        analysis_context += f"\n**ë°œê²¬ëœ ìœ„í—˜ ì¡°í•­ ìˆ˜:** {total_issues}ê°œ"
    
    # -----------------------------
    # 6) ì¹´í…Œê³ ë¦¬ë³„ ì¶”ê°€ ì§€ì¹¨ (ë³´ìˆ˜Â·ìˆ˜ë‹¹/ì €ì‘ê¶Œ ë“±)
    # -----------------------------
    category = selected_issue.get("category") if selected_issue else None
    category_rules = _get_category_rules(category)
    
    # -----------------------------
    # 7) ìµœì¢… í”„ë¡¬í”„íŠ¸
    # -----------------------------
    # ìƒí™© ë¶„ì„ ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš° ì¶”ê°€ ì§€ì‹œì‚¬í•­
    situation_analysis_note = ""
    if analysis_summary:
        situation_analysis_note = """
**âš ï¸ ì¤‘ìš”: ìƒí™© ë¶„ì„ ê²°ê³¼ ì»¨í…ìŠ¤íŠ¸**
- ì‚¬ìš©ìëŠ” ì´ë¯¸ ìƒí™© ë¶„ì„ ê²°ê³¼ë¥¼ ë°›ì•˜ìœ¼ë©°, ê·¸ ê²°ê³¼ë¥¼ í™”ë©´ì—ì„œ ë³´ê³  ìˆìŠµë‹ˆë‹¤.
- ë¶„ì„ ê²°ê³¼ì— í¬í•¨ëœ ë²•ì  ê·¼ê±°, ìœ„í—˜ë„, ê¶Œì¥ ì¡°ì¹˜ ë“±ì„ ì°¸ê³ í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”.
- ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ ì œê³µí•˜ì„¸ìš”.
- ë¶„ì„ ê²°ê³¼ì—ì„œ ì–¸ê¸‰ëœ ë‚´ìš©ê³¼ ì¼ê´€ì„± ìˆê²Œ ë‹µë³€í•˜ì„¸ìš”.

"""
    
    prompt = f"""{LEGAL_CHAT_SYSTEM_PROMPT}
{category_rules}
{situation_analysis_note}
**ì‚¬ìš©ì ì§ˆë¬¸:**
{query}

{issue_context}{analysis_context}

**ê´€ë ¨ ë²•ë ¹/ê°€ì´ë“œ/ì¼€ì´ìŠ¤ ë° ê³„ì•½ì„œ ì¡°í•­ ì»¨í…ìŠ¤íŠ¸:**
{context}

**âš ï¸ ì¤‘ìš”í•œ ì¶œë ¥ í˜•ì‹ ê·œì¹™:**
- ë°˜ë“œì‹œ ìœ íš¨í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.
- JSON ì™¸ì— ë‹¤ë¥¸ ì„¤ëª…, ë§ˆí¬ë‹¤ìš´ í—¤ë”, ìì—°ì–´ëŠ” ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
- ëª¨ë“  ë¬¸ìì—´ì€ ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”.

**ì‘ë‹µ í˜•ì‹ (TypeScript íƒ€ì… ê¸°ì¤€):**
```typescript
interface ParsedLegalResponse {{
  summary: string;                    // í•œ ë¬¸ì¥ìœ¼ë¡œ í•µì‹¬ ìœ„í—˜ ë˜ëŠ” ìŸì  ìš”ì•½
  riskLevel: 'ê²½ë¯¸' | 'ë³´í†µ' | 'ë†’ìŒ' | 'ë§¤ìš° ê³ ' | null;  // ìœ„í—˜ë„ ë ˆë²¨
  riskLevelDescription: string;       // ìœ„í—˜ë„ ì„¤ëª… (ì˜ˆ: "ë²•ì  ë¶„ìŸ ê°€ëŠ¥ì„±ì€ í¬ì§€ ì•Šì§€ë§Œ...")
  riskContent: Array<{{               // ë²•ì Â·ì‹¤ë¬´ ë¦¬ìŠ¤í¬ ìƒì„¸ ì„¤ëª… ë°°ì—´ (ìµœì†Œ 2-3ê°œ)
    ë‚´ìš©: string;                     // ë¦¬ìŠ¤í¬ í¬ì¸íŠ¸ ì œëª© (ì˜ˆ: "ë²•ì • ì„ê¸ˆ ì²­êµ¬ê¶Œ ì‚¬ì „ í¬ê¸°")
    ì„¤ëª…: string;                     // ë¦¬ìŠ¤í¬ ìƒì„¸ ì„¤ëª…
  }}>;
  checklist: Array<{{                  // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ë°°ì—´ (3-5ê°œ)
    í•­ëª©: string;                     // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© (ì˜ˆ: "ë²•ì • ì„ê¸ˆ ì²­êµ¬ê¶Œì´ ì œì–´ë˜ì§€ ì•ŠëŠ”ì§€")
    ê²°ë¡ : string;                      // ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²°ë¡ /ì„¤ëª…
  }}>;
  negotiationPoints: {{
    clauseModification?: string;      // ì¡°í•­ ìˆ˜ì • ì˜ˆì‹œ ë¬¸ì¥ (ì„ íƒ)
    conversationExamples: string[];   // í˜‘ìƒ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ë¬¸ì¥ ë°°ì—´ (ìµœì†Œ 1ê°œ ì´ìƒ)
  }};
  legalReferences: Array<{{            // ì°¸ê³  ë²•ë ¹ ë°°ì—´ (ìµœì†Œ 1ê°œ ì´ìƒ)
    name: string;                     // ë²•ë ¹ëª… (ì˜ˆ: "ê·¼ë¡œê¸°ì¤€ë²• ì œ43ì¡°")
    description: string;               // ë²•ë ¹ ì·¨ì§€ ë° ê³„ì•½ ì¡°í•­ê³¼ì˜ ê´€ê³„ ì„¤ëª…
  }}>;
}}
```

**ì œì•½ ì‚¬í•­:**
- riskLevelì´ nullì´ë”ë¼ë„ riskContent, riskLevelDescriptionì€ ìµœì†Œ 2ë¬¸ì¥ ì´ìƒ ì‘ì„±í•˜ì„¸ìš”.
- negotiationPoints.conversationExamplesëŠ” ìµœì†Œ 1ê°œ ì´ìƒ ìƒì„±í•˜ì„¸ìš”.
- legalReferencesëŠ” ìµœì†Œ 1ê°œ ì´ìƒ ìƒì„±í•˜ì„¸ìš”.
- summary, riskContent, checklist, negotiationPointsì˜ ëª¨ë“  ë¬¸ìì—´ì— "ìš”ì•½", "ë¦¬ìŠ¤í¬", "í˜‘ìƒ", "ì²´í¬" ê°™ì€ íƒ­ ì œëª©ì„ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
- JSON í˜•ì‹ë§Œ ë°˜í™˜í•˜ê³ , JSON ì•ë’¤ì— ì„¤ëª…ì´ë‚˜ ë§ˆí¬ë‹¤ìš´ì„ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ **ParsedLegalResponse í˜•ì‹ì˜ JSONë§Œ** ë°˜í™˜í•˜ì„¸ìš”.

**ê° í•„ë“œ ì‘ì„± ê°€ì´ë“œ:**

1. **summary**: í•œ ë¬¸ì¥ìœ¼ë¡œ í•µì‹¬ ìœ„í—˜ ë˜ëŠ” ìŸì ì„ ìš”ì•½í•˜ì„¸ìš”. ì„ íƒëœ ì´ìŠˆì˜ ì¹´í…Œê³ ë¦¬ì™€ ì‹¤ì œ ì¡°í•­ ë‚´ìš©ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

2. **riskLevel**: ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:
   - "ê²½ë¯¸": ë²•ì  ë¬¸ì œëŠ” ìˆìœ¼ë‚˜ ì‹¤ë¬´ì ìœ¼ë¡œ í° ë¶„ìŸ ê°€ëŠ¥ì„±ì€ ë‚®ì€ ê²½ìš°
   - "ë³´í†µ": ë²•ì  ìœ„ë°˜ ì†Œì§€ê°€ ìˆê³  ë¶„ìŸ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²½ìš°
   - "ë†’ìŒ": ê°•í–‰ê·œì • ìœ„ë°˜ ë“±ìœ¼ë¡œ ë¬´íš¨ ê°€ëŠ¥ì„±ì´ ë†’ê±°ë‚˜ ì‹¬ê°í•œ ë¶„ìŸ ìœ„í—˜ì´ ìˆëŠ” ê²½ìš°
   - null: ìœ„í—˜ë„ íŒë‹¨ì´ ì–´ë ¤ìš´ ê²½ìš°

3. **riskLevelDescription**: riskLevelì˜ ì´ìœ ë¥¼ í•œ ì¤„ë¡œ ê°„ë‹¨íˆ ì„¤ëª…í•˜ì„¸ìš” (ì˜ˆ: "ë²•ì  ë¶„ìŸ ê°€ëŠ¥ì„±ì€ í¬ì§€ ì•Šì§€ë§Œ, ì„ê¸ˆ êµ¬ì„± ë¶ˆëª…í™•ìœ¼ë¡œ ë¶„ìŸ ì‹œ ê·¼ë¡œìì—ê²Œ ë¶ˆë¦¬í•˜ê²Œ í•´ì„ë  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.")

4. **riskContent**: ë²•ì Â·ì‹¤ë¬´ ë¦¬ìŠ¤í¬ë¥¼ ê°ì²´ ë°°ì—´ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”. ê° ê°ì²´ëŠ” `{{"ë‚´ìš©": "...", "ì„¤ëª…": "..."}}` í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì¡°í•­ì˜ ë¬¸ì œì ì„ ê·¼ë¡œê¸°ì¤€ë²• ì¡°ë¬¸ êµ¬ì¡°(ì›ì¹™ vs ì˜ˆì™¸) ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê³ , ê° ë¦¬ìŠ¤í¬ í¬ì¸íŠ¸ë¥¼ ëª…í™•íˆ ë‚˜ì—´í•˜ì„¸ìš”. ê°•í–‰ê·œì • ìœ„ë°˜ ì†Œì§€ê°€ ìˆëŠ” ê²½ìš° "ê³„ì•½ì„œì— ì´ë ‡ê²Œ ì¨ ìˆì–´ë„ ê·¸ ë¶€ë¶„ì€ ë¬´íš¨ë¡œ íŒë‹¨ë  ì—¬ì§€ê°€ í½ë‹ˆë‹¤"ê¹Œì§€ ëª…ì‹œí•˜ì„¸ìš”. ë²• ì¡°í•­ì„ ì¸ìš©í•  ë•ŒëŠ” ì •í™•í•œ ì¡°í•­ ë²ˆí˜¸ì™€ ë‚´ìš©ì„ ì‚¬ìš©í•˜ì„¸ìš” (ì˜ˆ: ê·¼ë¡œê¸°ì¤€ë²• ì œ43ì¡°ì˜ ì„ê¸ˆ ì§€ê¸‰ ì›ì¹™). ê·¼ë¡œê¸°ì¤€ë²• ì œ17ì¡°ëŠ” "ê·¼ë¡œê³„ì•½ì˜ ì •ì˜" ì¡°í•­ì´ë¯€ë¡œ, êµ¬ì²´ì ì¸ ê¶Œë¦¬Â·ì˜ë¬´ ì„¤ëª…ì—ëŠ” ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
- **ì´ ì„¹ì…˜ì€ ë°˜ë“œì‹œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ë²•ì  ë¦¬ìŠ¤í¬ê°€ ê²½ë¯¸í•˜ë”ë¼ë„ ìµœì†Œ 2-3ê°œ í•­ëª©ìœ¼ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.**
- **ì¡°í•­ì˜ ë¬¸ì œì ì„ ê·¼ë¡œê¸°ì¤€ë²• ì¡°ë¬¸ êµ¬ì¡°(ì›ì¹™ vs ì˜ˆì™¸) ê¸°ì¤€ìœ¼ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.**
- ê´€ë ¨ ë²•ë ¹ì˜ ì›ì¹™ê³¼ ì˜ˆì™¸(ì‹œê¸° ë³€ê²½ê¶Œ ë“±)ë¥¼ êµ¬ë¶„í•˜ì—¬ ì„¤ëª…í•˜ê³ , ì´ ê³„ì•½ì„œ ë¬¸êµ¬ê°€ ì–´ë””ê¹Œì§€ëŠ” í—ˆìš©ë˜ê³  ì–´ë””ë¶€í„°ê°€ ê³¼ë„í•œì§€ íŒë‹¨í•˜ì„¸ìš”.
- ê° ë¦¬ìŠ¤í¬ í¬ì¸íŠ¸ë¥¼ ê°ì²´ë¡œ ëª…í™•íˆ ë‚˜ì—´í•˜ì„¸ìš” (ì˜ˆ: `{{"ë‚´ìš©": "ë²•ì • ì„ê¸ˆ ì²­êµ¬ê¶Œ ì‚¬ì „ í¬ê¸°", "ì„¤ëª…": "í¬ê´„ì„ê¸ˆì œ í•˜ì—ì„œ ì‹¤ì œ ê·¼ë¡œì‹œê°„ì„ ì´ˆê³¼í•  ê²½ìš° ê·¼ë¡œìê°€ ì¶”ê°€ ìˆ˜ë‹¹ì„ ì²­êµ¬í•˜ì§€ ì•ŠëŠ” ì¡°í•­ìœ¼ë¡œ, ê°•í–‰ê·œì •ì— ìœ„ë°˜ë˜ì–´ ë¬´íš¨ê°€ ë  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤."}}`)
- ì˜ˆì‹œ (ì—°ì°¨Â·íœ´ê°€ ì¡°í•­ì˜ ê²½ìš°):
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°ëŠ” "ì—°ì°¨ìœ ê¸‰íœ´ê°€ë¥¼ ë¶€ì—¬í•´ì•¼ í•œë‹¤ëŠ” ì˜ë¬´"ë¥¼ ì›ì¹™ìœ¼ë¡œ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  * ë‹¤ë§Œ "ì—…ë¬´ì— ì§€ì¥ì´ í° ê²½ìš° ì‹œê¸° ë³€ê²½ê¶Œ"ì€ ì˜ˆì™¸ë¡œ ì¸ì •ë˜ì§€ë§Œ, "ì•„ì˜ˆ íœ´ê°€ë¥¼ ë°•íƒˆí•  ìˆ˜ ìˆëŠ” ê¶Œí•œ"ì€ ì¸ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  * ë”°ë¼ì„œ "íšŒì‚¬ ì‚¬ì •ì— ë”°ë¼ ì—°ì°¨ë¥¼ ë¶€ì—¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤"ëŠ” í‘œí˜„ì€ ì‹œê¸° ë³€ê²½ê¶Œì„ ë„˜ì–´ì„œ ë¶€ì—¬ ìì²´ë¥¼ ê±°ë¶€í•˜ëŠ” ê²ƒìœ¼ë¡œ í•´ì„ë  ì—¬ì§€ê°€ ìˆì–´ ìœ„í—˜í•©ë‹ˆë‹¤.
- **ê°•í–‰ê·œì • ìœ„ë°˜ ì†Œì§€ê°€ ìˆëŠ” ê²½ìš°**: "ê³„ì•½ì„œì— ì´ë ‡ê²Œ ì¨ ìˆì–´ë„ ê·¸ ë¶€ë¶„ì€ ë¬´íš¨ë¡œ íŒë‹¨ë  ì—¬ì§€ê°€ í½ë‹ˆë‹¤"ê¹Œì§€ ëª…ì‹œí•˜ì„¸ìš”.
  ì˜ˆ: ì—°ì°¨ìœ ê¸‰íœ´ê°€, ìµœì €ì„ê¸ˆ, ì—°ì¥ê·¼ë¡œ í•œë„ ë“±ì€ ê°•í–‰ê·œì •ì´ë¯€ë¡œ ì´ë¥¼ ì œí•œí•˜ëŠ” ì¡°í•­ì€ ë¬´íš¨ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë²• ì¡°í•­ì„ ì¸ìš©í•  ë•ŒëŠ” ì •í™•í•œ ì¡°í•­ ë²ˆí˜¸ì™€ ë‚´ìš©ì„ ì‚¬ìš©í•˜ì„¸ìš” (ì˜ˆ: ê·¼ë¡œê¸°ì¤€ë²• ì œ43ì¡°ì˜ ì„ê¸ˆ ì§€ê¸‰ ì›ì¹™).
- **ë²• ì¡°í•­ ì¸ìš© ì •í™•ë„**: 
  * ê·¼ë¡œê¸°ì¤€ë²• ì œ17ì¡°ëŠ” "ê·¼ë¡œê³„ì•½ì˜ ì •ì˜" ì¡°í•­ì´ë¯€ë¡œ, êµ¬ì²´ì ì¸ ê¶Œë¦¬Â·ì˜ë¬´ ì„¤ëª…ì—ëŠ” ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
  * ê° ì¡°í•­ì˜ ì‹¤ì œ ë‚´ìš©ê³¼ ì¡°í•­ ë²ˆí˜¸ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
- ë³´ìˆ˜Â·ìˆ˜ë‹¹ ì¡°í•­ì˜ ê²½ìš°, ì„ê¸ˆ êµ¬ì„±Â·ê°€ì‚°ìˆ˜ë‹¹Â·ìµœì €ì„ê¸ˆÂ·ì§€ê¸‰ ì‹œê¸° ì¸¡ë©´ì—ì„œ ë¦¬ìŠ¤í¬ë¥¼ ë¶„ì„í•˜ì„¸ìš”.
- ì—°ì°¨Â·íœ´ê°€ ì¡°í•­ì˜ ê²½ìš°, ì—°ì°¨ ë¶€ì—¬ ìì²´ëŠ” ê°•í–‰ê·œì •ì´ë¯€ë¡œ ë¶€ì—¬ ê±°ë¶€ ì¡°í•­ì€ ë¬´íš¨ì¼ ìˆ˜ ìˆìŒì„ ëª…ì‹œí•˜ì„¸ìš”.
- ì €ì‘ê¶Œ ì¡°í•­ì˜ ê²½ìš°, ì—…ë¬´ìƒ ì €ì‘ë¬¼ê³¼ ê°œì¸ ì°½ì‘ë¬¼ì˜ êµ¬ë¶„ì„ ëª…í™•íˆ ì„¤ëª…í•˜ì„¸ìš”.

**JSON ì‘ë‹µ ì˜ˆì‹œ:**
```json
{{
  "summary": "ì´ ê³„ì•½ ì¡°í•­ì€ ì›”ê¸‰ ì§€ê¸‰ ë°©ì‹ë§Œ ëª…ì‹œí•˜ê³  ìˆìœ¼ë‚˜, ì„ê¸ˆ êµ¬ì„±ì´ ë¶ˆëª…í™•í•˜ì—¬ í–¥í›„ ì„ê¸ˆ ë¶„ìŸì˜ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤.",
  "riskLevel": "ê²½ë¯¸",
  "riskLevelDescription": "ë²•ì  ë¶„ìŸ ê°€ëŠ¥ì„±ì€ í¬ì§€ ì•Šì§€ë§Œ, ì„ê¸ˆ êµ¬ì„± ë¶ˆëª…í™•ìœ¼ë¡œ ë¶„ìŸ ì‹œ ê·¼ë¡œìì—ê²Œ ë¶ˆë¦¬í•˜ê²Œ í•´ì„ë  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.",
  "riskContent": [
    {{
      "ë‚´ìš©": "ì„ê¸ˆ êµ¬ì„± ë¶ˆëª…í™•",
      "ì„¤ëª…": "ì—°ì¥Â·ì•¼ê°„ê·¼ë¡œìˆ˜ë‹¹, í‡´ì§ê¸ˆ ì‚°ì • ì‹œ ê¸°ì¤€ì´ ëª¨í˜¸í•˜ì—¬ í–¥í›„ ë¶„ìŸì˜ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤."
    }},
    {{
      "ë‚´ìš©": "í¬ê´„ì„ê¸ˆìœ¼ë¡œ ì£¼ì¥ë  ì—¬ì§€",
      "ì„¤ëª…": "ì‹¤ì œë¡œëŠ” ì—°ì¥ê·¼ë¡œë¥¼ ê±°ì˜ í•˜ì§€ ì•Šì•˜ëŠ”ë°ë„, ì‚¬ìš©ìê°€ 'ì´ë¯¸ í¬í•¨ë¼ ìˆë‹¤'ê³  ì£¼ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    }},
    {{
      "ë‚´ìš©": "ìµœì €ì„ê¸ˆ / ì†Œì •ê·¼ë¡œì‹œê°„ ê²€ì¦ì´ ì–´ë ¤ì›€",
      "ì„¤ëª…": "ì„ê¸ˆ êµ¬ì„±ì´ ë¶ˆëª…í™•í•˜ì—¬ ìµœì €ì„ê¸ˆ ì¤€ìˆ˜ ì—¬ë¶€ì™€ ì†Œì •ê·¼ë¡œì‹œê°„ì„ ê²€ì¦í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤."
    }}
  ],
  "checklist": [
    {{
      "í•­ëª©": "ì„ê¸ˆ êµ¬ì„±(ê¸°ë³¸ê¸‰/ìˆ˜ë‹¹/ì„±ê³¼ê¸‰)ì´ ëª…í™•í•˜ê²Œ êµ¬ë¶„ë˜ì–´ ìˆëŠ”ì§€",
      "ê²°ë¡ ": "ì„ê¸ˆ êµ¬ì„±ì´ ë¶ˆëª…í™•í•˜ë©´ í–¥í›„ ì„ê¸ˆ ë¶„ìŸì˜ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤."
    }},
    {{
      "í•­ëª©": "ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œìˆ˜ë‹¹ì´ ë³„ë„ë¡œ ì§€ê¸‰ë˜ëŠ”ì§€, ì•„ë‹ˆë©´ ì—°ë´‰Â·í¬ê´„ì„ê¸ˆì— í¬í•¨ëœë‹¤ê³  ë˜ì–´ ìˆëŠ”ì§€",
      "ê²°ë¡ ": "í¬ê´„ì„ê¸ˆì œì˜ ê²½ìš° ëª‡ ì‹œê°„ë¶„ì˜ ì—°ì¥ê·¼ë¡œê°€ í¬í•¨ëœ ê²ƒì¸ì§€ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤."
    }},
    {{
      "í•­ëª©": "ì„ê¸ˆ ì§€ê¸‰ ì‹œê¸°Â·ë°©ë²•ì´ ëª…í™•í•œì§€ (ë§¤ì›” 1íšŒ ì´ìƒ, ì •í•´ì§„ ì§€ê¸‰ì¼ ë“±)",
      "ê²°ë¡ ": "ì„ê¸ˆ ì§€ê¸‰ ì‹œê¸°ì™€ ë°©ë²•ì´ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ ë¶„ìŸì˜ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤."
    }},
    {{
      "í•­ëª©": "ìµœì €ì„ê¸ˆ ì´ìƒì´ ë³´ì¥ë˜ëŠ” êµ¬ì¡°ì¸ì§€",
      "ê²°ë¡ ": "ìµœì €ì„ê¸ˆ ë¯¸ë§Œì˜ ì„ê¸ˆ ì§€ê¸‰ì€ ê°•í–‰ê·œì • ìœ„ë°˜ìœ¼ë¡œ ë¬´íš¨ì…ë‹ˆë‹¤."
    }}
  ],
  "negotiationPoints": {{
    "clauseModification": "ê¸°ì¡´: 'ì›”ê¸‰: 2,000,000ì›'\\nìˆ˜ì •ì•ˆ: 'ê¸°ë³¸ê¸‰: 1,800,000ì›, ê³ ì •ì  ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹: 150,000ì›, ì‹ëŒ€ ë° ê¸°íƒ€ ìˆ˜ë‹¹: 50,000ì›'",
    "conversationExamples": [
      "í˜„ì¬ ê³„ì•½ì„œì—ëŠ” ì„ê¸ˆ êµ¬ì„±ì´ ëª…í™•í•˜ì§€ ì•Šì•„ í–¥í›„ ì„ê¸ˆ ê³„ì‚° ì‹œ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê¸‰, ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹, ê¸°íƒ€ ìˆ˜ë‹¹ ë“±ì„ êµ¬ë¶„í•˜ì—¬ ëª…ì‹œí•´ ì£¼ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.",
      "ì—°ë´‰ì— í¬í•¨ëœ ìˆ˜ë‹¹ì´ ì •í™•íˆ ëª‡ ì‹œê°„ë¶„ì˜ ì—°ì¥Â·ì•¼ê°„ê·¼ë¡œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œ ê²ƒì¸ì§€ ê³„ì•½ì„œì— ìˆ«ìë¡œ ëª…ì‹œí•´ ì£¼ì…¨ìœ¼ë©´ í•©ë‹ˆë‹¤."
    ]
  }},
  "legalReferences": [
    {{
      "name": "ê·¼ë¡œê¸°ì¤€ë²• ì œ43ì¡°",
      "description": "ì„ê¸ˆì˜ ì§ì ‘Â·ì „ì•¡Â·ì •ê¸° ì§€ê¸‰ ì›ì¹™ì„ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì„ê¸ˆ êµ¬ì„±ì´ ë¶ˆëª…í™•í•˜ë©´ ì§€ê¸‰ ì‹œê¸°ì™€ ë°©ë²•ì„ ëª…í™•íˆ í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤."
    }},
    {{
      "name": "ê·¼ë¡œê¸°ì¤€ë²• ì œ56ì¡°",
      "description": "ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œì— ëŒ€í•œ ê°€ì‚°ìˆ˜ë‹¹ ê·œì •ì…ë‹ˆë‹¤. í¬ê´„ì„ê¸ˆì œë¼ë©´ ëª‡ ì‹œê°„ë¶„ì˜ ì—°ì¥ê·¼ë¡œê°€ í¬í•¨ëœ ê²ƒì¸ì§€ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤."
    }}
  ]
}}
```
"""
    
    return prompt


def build_situation_chat_prompt(
    query: str,
    legal_chunks: list = None,
    analysis_summary: str = None,
    criteria: list = None,
    checklist: list = None,
    related_cases: list = None,
) -> str:
    """
    ìƒí™©ë¶„ì„ ì±—ìš© í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    
    Args:
        query: ì‚¬ìš©ì ì§ˆë¬¸
        legal_chunks: ë²•ë ¹ ì²­í¬
        analysis_summary: ë¶„ì„ ìš”ì•½
        criteria: ë²•ì  íŒë‹¨ ê¸°ì¤€
        checklist: ì²´í¬ë¦¬ìŠ¤íŠ¸
        related_cases: ê´€ë ¨ ì¼€ì´ìŠ¤
    
    Returns:
        ì™„ì„±ëœ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´
    """
    context_parts = []
    
    # -----------------------------
    # 1) ë²•ë ¹ ì²­í¬
    # -----------------------------
    if legal_chunks:
        context_parts.append("\n=== ê´€ë ¨ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ ===")
        for chunk in legal_chunks[:5]:
            source_type = getattr(chunk, 'source_type', 'law')
            title = getattr(chunk, 'title', '')
            snippet = getattr(chunk, 'snippet', getattr(chunk, 'content', ''))[:500]
            context_parts.append(f"[{source_type}] {title}\n{snippet}")
    
    context = "\n\n".join(context_parts)
    
    # -----------------------------
    # 2) ë¶„ì„ ìš”ì•½ ì •ë³´
    # -----------------------------
    analysis_context = ""
    if analysis_summary:
        analysis_context = f"""
**ìƒí™© ë¶„ì„ ê²°ê³¼ (í˜„ì¬ í™”ë©´ì— í‘œì‹œëœ ë¶„ì„ ê²°ê³¼):**

{analysis_summary}

**ì¤‘ìš”:** ìœ„ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”. ì‚¬ìš©ìëŠ” ì´ë¯¸ ì´ ë¶„ì„ ê²°ê³¼ë¥¼ ë³´ê³  ìˆìœ¼ë©°, ì´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´í•´í•˜ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.
"""
    
    # -----------------------------
    # 3) ë²•ì  íŒë‹¨ ê¸°ì¤€
    # -----------------------------
    criteria_context = ""
    if criteria:
        criteria_text = "\n".join([
            f"- {c.get('name', '')}: {c.get('reason', '')}" 
            for c in criteria[:5]
        ]) if criteria else "ì—†ìŒ"
        criteria_context = f"""
**ë²•ì  íŒë‹¨ ê¸°ì¤€:**
{criteria_text}
"""
    
    # -----------------------------
    # 4) ì²´í¬ë¦¬ìŠ¤íŠ¸
    # -----------------------------
    checklist_context = ""
    if checklist:
        checklist_text = "\n".join([
            f"- {item}" for item in checklist[:5]
        ]) if checklist else "ì—†ìŒ"
        checklist_context = f"""
**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
{checklist_text}
"""
    
    prompt = f"""{LEGAL_CHAT_SYSTEM_PROMPT}

**âš ï¸ ì¤‘ìš”: ìƒí™© ë¶„ì„ ê²°ê³¼ ì»¨í…ìŠ¤íŠ¸**
- ì‚¬ìš©ìëŠ” ì´ë¯¸ ìƒí™© ë¶„ì„ ê²°ê³¼ë¥¼ ë°›ì•˜ìœ¼ë©°, ê·¸ ê²°ê³¼ë¥¼ í™”ë©´ì—ì„œ ë³´ê³  ìˆìŠµë‹ˆë‹¤.
- ë¶„ì„ ê²°ê³¼ì— í¬í•¨ëœ ë²•ì  ê·¼ê±°, ìœ„í—˜ë„, ê¶Œì¥ ì¡°ì¹˜ ë“±ì„ ì°¸ê³ í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”.
- ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ ì œê³µí•˜ì„¸ìš”.
- ë¶„ì„ ê²°ê³¼ì—ì„œ ì–¸ê¸‰ëœ ë‚´ìš©ê³¼ ì¼ê´€ì„± ìˆê²Œ ë‹µë³€í•˜ì„¸ìš”.

**ì‚¬ìš©ì ì§ˆë¬¸:**
{query}

{analysis_context}
{criteria_context}
{checklist_context}

**ê´€ë ¨ ë²•ë ¹/ê°€ì´ë“œ/ì¼€ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸:**
{context}

**âš ï¸ ë§¤ìš° ì¤‘ìš”í•œ ì¶œë ¥ í˜•ì‹ ê·œì¹™:**
- **ë°˜ë“œì‹œ ```json ì½”ë“œ ë¸”ë¡ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”.**
- **ì‘ë‹µì€ ë°˜ë“œì‹œ ```jsonìœ¼ë¡œ ì‹œì‘í•˜ê³  ```ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤.**
- **JSON ì½”ë“œ ë¸”ë¡ ì•ˆì— ìœ íš¨í•œ JSON ê°ì²´ë§Œ í¬í•¨í•˜ì„¸ìš”.**
- **JSON ì™¸ì— ë‹¤ë¥¸ ì„¤ëª…, ë§ˆí¬ë‹¤ìš´ í—¤ë”, ìì—°ì–´, ë²ˆí˜¸ ëª©ë¡ì€ ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.**
- **"1. SituationChatResponse:" ê°™ì€ í…ìŠ¤íŠ¸ë¥¼ ì•ì— ë¶™ì´ì§€ ë§ˆì„¸ìš”.**
- **"2. ëŒ€í™” ì˜ˆì‹œ:" ê°™ì€ ì¶”ê°€ ì„¤ëª…ì„ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.**
- ëª¨ë“  ë¬¸ìì—´ì€ ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”.

**ì‘ë‹µ í˜•ì‹ (ìƒí™©ë¶„ì„ìš©):**
```typescript
interface SituationChatResponse {{
  reportTitle: string;                    // ë¦¬í¬íŠ¸ ì œëª© (ì˜ˆ: "ğŸ“Š ìƒí™© ë¶„ì„ì˜ ê²°ê³¼")
  legalPerspective: {{
    description: string;                  // ë²•ì  ê´€ì ì—ì„œ ë³¸ í˜„ì¬ ìƒí™© ì„¤ëª…
    references: Array<{{                  // ì°¸ê³  ë¬¸ì„œ ë°°ì—´
      name: string;                      // ë¬¸ì„œëª…
      description: string;               // ë¬¸ì„œ ì„¤ëª…
    }}>;
  }};
  actions: Array<{{                       // í–‰ë™ í•­ëª© ë°°ì—´
    description: string;                 // í–‰ë™ ì„¤ëª…
    key: string;                         // í–‰ë™ í‚¤ (ì˜ˆ: "1", "2", "3")
  }}>;
  conversationExamples: Array<{{          // ëŒ€í™” ì˜ˆì‹œ ë°°ì—´
    role: 'user' | 'assistant';
    content: string;
  }}>;
}}
```

**ì œì•½ ì‚¬í•­:**
- legalPerspective.referencesëŠ” ìµœì†Œ 1ê°œ ì´ìƒ ìƒì„±í•˜ì„¸ìš”.
- actionsëŠ” ìµœì†Œ 3ê°œ ì´ìƒ ìƒì„±í•˜ì„¸ìš”.
- conversationExamplesëŠ” ìµœì†Œ 1ê°œ ì´ìƒ ìƒì„±í•˜ì„¸ìš”.
- **ë°˜ë“œì‹œ ```json ì½”ë“œ ë¸”ë¡ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”.**
- **JSON ì•ë’¤ì— ì„¤ëª…ì´ë‚˜ ë§ˆí¬ë‹¤ìš´ì„ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.**
- **"1. SituationChatResponse:" ê°™ì€ ë²ˆí˜¸ ëª©ë¡ì´ë‚˜ í—¤ë”ë¥¼ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.**

**âš ï¸ ìµœì¢… í™•ì¸:**
- ì‘ë‹µì€ ë°˜ë“œì‹œ ```jsonìœ¼ë¡œ ì‹œì‘í•˜ê³  ```ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤.
- ```json ì½”ë“œ ë¸”ë¡ ì•ˆì— ìœ íš¨í•œ JSON ê°ì²´ë§Œ í¬í•¨í•˜ì„¸ìš”.
- JSON ì•ì— "1. SituationChatResponse:" ê°™ì€ í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤.
- JSON ë’¤ì— "2. ëŒ€í™” ì˜ˆì‹œ:" ê°™ì€ ì¶”ê°€ ì„¤ëª…ì´ ìˆìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤.

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ **```json ì½”ë“œ ë¸”ë¡ í˜•ì‹ì˜ SituationChatResponse**ë¥¼ ë°˜í™˜í•˜ì„¸ìš”.

**ê° í•„ë“œ ì‘ì„± ê°€ì´ë“œ:**

1. **reportTitle**: ìƒí™© ë¶„ì„ ë¦¬í¬íŠ¸ì˜ ì œëª© (ì˜ˆ: "ğŸ“Š ìƒí™© ë¶„ì„ì˜ ê²°ê³¼")

2. **legalPerspective.description**: í˜„ì¬ ìƒí™©ì„ ë²•ì ìœ¼ë¡œ í‰ê°€í•œ ë‚´ìš©. ê´€ë ¨ ë¬¸ì„œë¥¼ í™•ì¸í•˜ê³ , ìƒí™©ì˜ ë²•ì  ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ì„¸ìš”.

3. **legalPerspective.references**: ê´€ë ¨ ë²•ë ¹/ê°€ì´ë“œ ë¬¸ì„œ ë°°ì—´. legal_chunksì—ì„œ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.

4. **actions**: ì‚¬ìš©ìê°€ í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ í–‰ë™ í•­ëª©. ìƒí™© ë¶„ì„ ê²°ê³¼ì˜ checklistì™€ criteriaë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.

5. **conversationExamples**: ì‚¬ìš©ìì™€ AIì˜ ëŒ€í™” ì˜ˆì‹œ. ì‚¬ìš©ìì˜ ì§ˆë¬¸ê³¼ AIì˜ ë‹µë³€ì„ í¬í•¨í•˜ì„¸ìš”.

**ì‘ë‹µ í˜•ì‹ ì˜ˆì‹œ:**
```json
{{
  "reportTitle": "ğŸ“Š ìƒí™© ë¶„ì„ì˜ ê²°ê³¼",
  "legalPerspective": {{
    "description": "í˜„ì¬ ìƒí™©ì„ ë²•ì ìœ¼ë¡œ í‰ê°€í•´ì•¼ í•©ë‹ˆë‹¤. ê´€ë ¨ ë¬¸ì„œë¥¼ í™•ì¸í•˜ê³ , ì‹œê°„ê¸‰ì œë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤ëŠ” ì ì— ì£¼ëª©í•˜ì„¸ìš”.",
    "references": [
      {{
        "name": "ê°œì •+í‘œì¤€ì·¨ì—…ê·œì¹™(2025ë…„, +ë°°í¬).hwp.pdf",
        "description": "ì´ ë¬¸ì„œì—ì„œëŠ” ì„ê¸ˆì€ ì‹œê°„ê¸‰ì œë¥¼ ì›ì¹™ìœ¼ë¡œ í•˜ë©°, ìµœì €ì„ê¸ˆì˜ ì ìš©ì„ ë°›ëŠ” ì‚¬ì›ì—ê²Œ ìµœì €ì„ê¸ˆì•¡ ì´ìƒì˜ ì„ê¸ˆì„ ì§€ê¸‰í•´ì•¼ í•œë‹¤ê³  ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤."
      }}
    ]
  }},
  "actions": [
    {{
      "description": "ìƒí™©ì„ ê°ê´€ì ìœ¼ë¡œ ì •ë¦¬í•˜ì„¸ìš”",
      "key": "1"
    }},
    {{
      "description": "ê´€ë ¨ ë¬¸ì„œë¥¼ ë³´ê´€í•˜ì„¸ìš”",
      "key": "2"
    }},
    {{
      "description": "ì¦ê±° ìë£Œë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”",
      "key": "3"
    }}
  ],
  "conversationExamples": [
    {{
      "role": "user",
      "content": "ì´ ìƒí™©ì—ì„œëŠ” ì‚¬ìš©ìê°€ ë¬´ì—‡ì„ í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?"
    }},
    {{
      "role": "assistant",
      "content": "ì‚¬ìš©ìëŠ” ìƒí™©ì„ ê°ê´€ì ìœ¼ë¡œ ì •ë¦¬í•˜ê³ , ê´€ë ¨ ë¬¸ì„œë¥¼ ë³´ê´€í•˜ê³ , ì¦ê±° ìë£Œë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    }}
  ]
}}
```

**âš ï¸ ì¤‘ìš”:** ìœ„ ì˜ˆì‹œì²˜ëŸ¼ ë°˜ë“œì‹œ ```jsonìœ¼ë¡œ ì‹œì‘í•˜ê³  ```ë¡œ ëë‚˜ëŠ” ì½”ë“œ ë¸”ë¡ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”.

---

**âš ï¸ ì°¸ê³ :** ì´ ë‹µë³€ì€ ì •ë³´ ì•ˆë‚´ë¥¼ ìœ„í•œ ê²ƒì´ë©° ë²•ë¥  ìë¬¸ì´ ì•„ë‹™ë‹ˆë‹¤. ì¤‘ìš”í•œ ì‚¬ì•ˆì€ ì „ë¬¸ ë³€í˜¸ì‚¬ë‚˜ ë…¸ë™ìœ„ì›íšŒ ë“± ì „ë¬¸ ê¸°ê´€ì— ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
"""
    
    return prompt


# ============================================================================
# ê³„ì•½ì„œ ë¶„ì„ í”„ë¡¬í”„íŠ¸
# ============================================================================

CONTRACT_ANALYSIS_SYSTEM_PROMPT = """ë‹¹ì‹ ì€ í•œêµ­ ë…¸ë™ë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ê³„ì•½ì„œë¥¼ ë¶„ì„í•˜ì—¬ ìœ„í—˜ ì¡°í•­ì„ ì‹ë³„í•˜ê³  ê°œì„ ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.

**ì¤‘ìš”: ëª¨ë“  ì‘ë‹µì€ ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.**

**ë¶„ì„ ì›ì¹™:**
1. ê·¼ë¡œê¸°ì¤€ë²•, ìµœì €ì„ê¸ˆë²• ë“± ê´€ë ¨ ë²•ë ¹ì„ ê¸°ì¤€ìœ¼ë¡œ ë¶„ì„
2. í‘œì¤€ê·¼ë¡œê³„ì•½ì„œì™€ ë¹„êµí•˜ì—¬ ëˆ„ë½/ê³¼ë„í•œ ì¡°í•­ ì‹ë³„
3. ê° ìœ„í—˜ ì¡°í•­ì— ëŒ€í•´ êµ¬ì²´ì ì¸ ë²•ì  ê·¼ê±° ì œì‹œ
4. ì‹¤ë¬´ì ì¸ ê°œì„ ì•ˆê³¼ í˜‘ìƒ í¬ì¸íŠ¸ ì œì‹œ
5. ëª¨ë“  í…ìŠ¤íŠ¸ ì‘ë‹µ(summary, description, rationale ë“±)ì€ í•œêµ­ì–´ë¡œ ì‘ì„±
"""


def build_contract_analysis_prompt(
    contract_text: str,
    clauses: list = None,
    grounding_chunks: list = None,
    contract_chunks: list = None,
    description: str = None,
    contract_type: Optional[str] = None,
    user_role: Optional[str] = None,
    field: Optional[str] = None,
    concerns: Optional[str] = None,
) -> str:
    """
    ê³„ì•½ì„œ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸ êµ¬ì„± (clause_id ê¸°ë°˜)
    
    Args:
        contract_text: ê³„ì•½ì„œ í…ìŠ¤íŠ¸ (ì°¸ê³ ìš©)
        clauses: ì¶”ì¶œëœ clause ë¦¬ìŠ¤íŠ¸ (í•„ìˆ˜)
        grounding_chunks: ê´€ë ¨ ë²•ë ¹ ì²­í¬ (legal_chunks)
        contract_chunks: ê³„ì•½ì„œ ë‚´ë¶€ ì²­í¬ (contract_chunks, ë ˆê±°ì‹œ í˜¸í™˜)
        description: ì¶”ê°€ ìƒí™© ì„¤ëª…
    
    Returns:
        ì™„ì„±ëœ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´
    """
    # clausesê°€ ì—†ìœ¼ë©´ ì—ëŸ¬
    if not clauses:
        logger.warning("[í”„ë¡¬í”„íŠ¸ ìƒì„±] clausesê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë¹ˆ í”„ë¡¬í”„íŠ¸ ë°˜í™˜.")
        return ""
    
    # clause ì»¨í…ìŠ¤íŠ¸ ë¬¸ìì—´ ë§Œë“¤ê¸°
    clause_lines = []
    for c in clauses:
        snippet = c.get("content", "")
        if len(snippet) > 400:
            snippet = snippet[:400] + "..."
        clause_id = c.get("id", "")
        title = c.get("title", "")
        clause_lines.append(
            f'- [{clause_id}] {title}\n  "{snippet}"'
        )
    clause_context = "\n".join(clause_lines)
    
    # ë²•ë ¹ ì»¨í…ìŠ¤íŠ¸ ì¤€ë¹„
    legal_lines = []
    if grounding_chunks:
        # ê²€ìƒ‰ëœ ëª¨ë“  legal_chunks ì‚¬ìš© (ìµœëŒ€ 15ê°œë¡œ ì œí•œí•˜ì—¬ í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ê´€ë¦¬)
        max_legal_chunks = min(len(grounding_chunks), 15)
        for g in grounding_chunks[:max_legal_chunks]:
            # LegalGroundingChunkëŠ” Pydantic ëª¨ë¸ì´ë¯€ë¡œ getattr ì‚¬ìš©
            source_type = getattr(g, 'source_type', 'law')
            title = getattr(g, 'title', '')
            snippet = getattr(g, 'snippet', getattr(g, 'content', ''))
            # snippet ê¸¸ì´ë¥¼ 300ìë¡œ ëŠ˜ë ¤ì„œ ë” ë§ì€ ì •ë³´ ì œê³µ
            if len(snippet) > 300:
                snippet = snippet[:300] + "..."
            legal_lines.append(
                f'- ({source_type}) {title}: "{snippet}"'
            )
    legal_context = "\n".join(legal_lines) if legal_lines else "(ì°¸ê³  ë²•ë ¹ ì—†ìŒ)"
    
    # ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ì •ë³´ êµ¬ì„±
    user_context = []
    if contract_type:
        contract_type_map = {
            "freelancer": "í”„ë¦¬ëœì„œ",
            "part_time": "ì•Œë°”/íŒŒíŠ¸íƒ€ì„",
            "regular": "ì •ê·œì§",
            "service": "ìš©ì—­",
            "other": "ê¸°íƒ€"
        }
        user_context.append(f"- ê³„ì•½ ì¢…ë¥˜: {contract_type_map.get(contract_type, contract_type)}")
    
    if user_role:
        role_map = {
            "worker": "ì„(í”„ë¦¬ëœì„œ/ê·¼ë¡œì)",
            "employer": "ê°‘(ë°œì£¼ì‚¬/ê³ ìš©ì£¼)"
        }
        user_context.append(f"- ì—­í• : {role_map.get(user_role, user_role)}")
    
    if field:
        field_map = {
            "it_dev": "IT ê°œë°œ",
            "design": "ë””ìì¸",
            "marketing": "ë§ˆì¼€íŒ…",
            "other": "ê¸°íƒ€"
        }
        user_context.append(f"- ë¶„ì•¼: {field_map.get(field, field)}")
    
    if concerns:
        user_context.append(f"- ìš°ì„  í™•ì¸í•˜ê³  ì‹¶ì€ ê³ ë¯¼: {concerns}")
    
    user_context_str = "\n".join(user_context) if user_context else "(ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ì—†ìŒ)"
    
    system_prompt = """ë‹¹ì‹ ì€ í”„ë¦¬ëœì„œ/ì²­ë…„ ê·¼ë¡œì ê´€ì ì—ì„œ ê³„ì•½ì„œë¥¼ ì ê²€í•˜ëŠ” ê³„ì•½ ë¶„ì„ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

- ì„(í”„ë¦¬ëœì„œ/ê·¼ë¡œì)ì˜ ê¶Œë¦¬ë¥¼ ë³´í˜¸í•˜ëŠ” ê´€ì ì—ì„œ ê³„ì•½ì„œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
- ë…ì†Œì¡°í•­(ì„ì—ê²Œ ê³¼ë„í•˜ê²Œ ë¶ˆë¦¬í•œ ì¡°í•­)ì„ ìš°ì„ ì ìœ¼ë¡œ ì°¾ì•„ëƒ…ë‹ˆë‹¤.
- ëª¨ë“  ì‘ë‹µì€ ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
"""
    
    user_prompt = f"""[ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸]

{user_context_str}

[ê³„ì•½ì„œ ì¡°í•­ ëª©ë¡]

ë‹¤ìŒì€ ì´ ê³„ì•½ì„œë¥¼ ì¡°í•­ë³„ë¡œ ë‚˜ëˆˆ ëª©ë¡ì…ë‹ˆë‹¤.
ê° í•­ëª©ì—ëŠ” "clause_id", "title", "content"ê°€ í¬í•¨ë©ë‹ˆë‹¤.

{clause_context}

[ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸]

{legal_context}

[ë¶„ì„ í•­ëª©]

ê³„ì•½ì„œë¥¼ ë‹¤ìŒ 9ê°œ í•­ëª©ë³„ë¡œ ë¶„ì„í•˜ì„¸ìš”:

1. í•µì‹¬ ìš”ì•½: ê³„ì•½ ëª©ì Â·ì—…ë¬´ ë‚´ìš©, ê³„ì•½ ê¸°ê°„, ì´ ê¸ˆì•¡Â·ì§€ê¸‰ ë°©ì‹
2. ëˆÂ·ëŒ€ê¸ˆ: ì§€ê¸‰ ë°©ì‹, ì§€ê¸‰ ê¸°í•œ, ì§€ì—° ì‹œ ì´ì/ì§€ì—°ì†í•´ê¸ˆ, ë¹„ìš© í¬í•¨ ì—¬ë¶€
3. ì—…ë¬´ ë²”ìœ„Â·ê·¼ë¡œì¡°ê±´: ì—…ë¬´ ë²”ìœ„ í¬ê´„ì„±, ì¶”ê°€ ì—…ë¬´ ê·œì •, ê·¼ë¬´ ì‹œê°„/íœ´ê²Œ/ì—°ì¥ê·¼ë¡œ ìˆ˜ë‹¹
4. ê¸°ê°„Â·í•´ì§€: ê³„ì•½ ê¸°ê°„, ìë™ ì—°ì¥, ê°‘/ì„ í•´ì§€ê¶Œ ëŒ€ì¹­ì„±, í•´ì§€ ì‹œ ëŒ€ê¸ˆ ì •ì‚°, ìœ„ì•½ê¸ˆ/ì†í•´ë°°ìƒ
5. ì§€ì‹ì¬ì‚°ê¶Œ(IP)Â·ì‚°ì¶œë¬¼: ì‚°ì¶œë¬¼ ì €ì‘ê¶Œ ì†Œìœ ì, í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€, 2ì°¨ì  ì €ì‘ë¬¼ ê¸ˆì§€ ë²”ìœ„
6. ë¹„ë°€ìœ ì§€(NDA): ë¹„ë°€ ì •ë³´ ë²”ìœ„, ë¹„ë°€ìœ ì§€ ê¸°ê°„, ìœ„ë°˜ ì‹œ ì±…ì„ ë²”ìœ„
7. ê²½ìŸê¸ˆì§€Â·ê²¸ì—… ì œí•œ: ê³„ì•½ ì¢…ë£Œ í›„ ê¸ˆì§€ ê¸°ê°„/ë²”ìœ„, ì§€ë¦¬ì /ì—…ì¢… ë²”ìœ„, ë°˜ëŒ€ ê¸‰ë¶€ ì—¬ë¶€
8. ì±…ì„Â·ì†í•´ë°°ìƒÂ·ë©´ì±…: ë¬´ì œí•œ ì±…ì„ ì¡°í•­, ê°„ì ‘ì†í•´/íŠ¹ë³„ì†í•´ ë°°ìƒ, ê°‘ì˜ ê³¼ì‹¤ ì±…ì„ ì „ê°€
9. ë¶„ìŸí•´ê²°: ê´€í•  ë²•ì›, ë¶„ìŸ í•´ê²° ì ˆì°¨

[ë…ì†Œì¡°í•­ íƒì§€ ê¸°ì¤€]

ì•„ë˜ì— í•´ë‹¹í•˜ë©´ ë…ì†Œì¡°í•­ìœ¼ë¡œ í‘œì‹œí•˜ì„¸ìš”:

- ëŒ€ê¸ˆ ì§€ê¸‰: "ê²€ìˆ˜ ì™„ë£Œ í›„ ì§€ê¸‰"ë§Œ ìˆê³  ê²€ìˆ˜ ê¸°ì¤€/ê¸°ê°„ì´ ì—†ìŒ
- ìœ„ì•½ê¸ˆÂ·ì§€ì—° ì†í•´ê¸ˆ: ì„ì—ê²Œë§Œ ê³¼ë„í•œ ìœ„ì•½ê¸ˆ, ê°‘ ì§€ê¸‰ ì§€ì—° ì‹œ íŒ¨ë„í‹° ì—†ìŒ
- ë¬´ì œí•œ ì†í•´ë°°ìƒ: "ì–´ë–¤ ê²½ìš°ì—ë„ ëª¨ë“  ì†í•´ë¥¼ ì „ë¶€ ë°°ìƒí•œë‹¤" ê°™ì€ ì¡°í•­
- ì¼ë°©ì  í•´ì§€ê¶Œ: ê°‘ì€ ì–¸ì œë“  í•´ì§€ ê°€ëŠ¥, ì„ì€ í•´ì§€ ì–´ë ¤ì›€
- ê³¼ë„í•œ ê²½ìŸê¸ˆì§€: ì¢…ë£Œ í›„ 1~3ë…„ ì´ìƒ, ì—…ê³„ ì „ë°˜ ê¸ˆì§€, ëŒ€ê°€ ì—†ìŒ
- IP ì™„ì „ ì–‘ë„: ëª¨ë“  ì°½ì‘ë¬¼ ì €ì‘ê¶Œ ì˜êµ¬ ì–‘ë„, í¬íŠ¸í´ë¦¬ì˜¤ ê¸ˆì§€
- ì¼ë°©ì  ë³€ê²½ ê¶Œí•œ: ê°‘ì´ ì¼ë°©ì ìœ¼ë¡œ ê³„ì•½ ìˆ˜ì • ê°€ëŠ¥

[íŠ¹íˆ ë°˜ë“œì‹œ ì²´í¬í•´ì•¼ í•˜ëŠ” 'ë²•ì • ìˆ˜ë‹¹ ì²­êµ¬ê¶Œ í¬ê¸°' íŒ¨í„´]

ì•„ë˜ì™€ ê°™ì€ ë¬¸ì¥ì€ ëŒ€í•œë¯¼êµ­ ê·¼ë¡œê¸°ì¤€ë²•ìƒ ê°•í–‰ê·œì •ì„ ì‚¬ì „ì— í¬ê¸°ì‹œí‚¤ëŠ” ë‚´ìš©ìœ¼ë¡œ ë§¤ìš° ìœ„í—˜ë„ê°€ ë†’ì€ ì¡°í•­ì´ë¯€ë¡œ, í•­ìƒ ë³„ë„ì˜ ì´ìŠˆë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

- "ì¶”ê°€ ìˆ˜ë‹¹ì„ ì‚¬ì—…ì£¼ì—ê²Œ ì²­êµ¬í•˜ì§€ ì•Šê¸°ë¡œ í•©ì˜í•œë‹¤"
- "ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œ ìˆ˜ë‹¹ì„ ë³„ë„ë¡œ ì²­êµ¬í•˜ì§€ ì•ŠëŠ”ë‹¤"
- "ê·¼ë¡œìëŠ” ë²•ì—ì„œ ì •í•œ ìˆ˜ë‹¹ì„ ì²­êµ¬í•˜ì§€ ì•Šê¸°ë¡œ í•œë‹¤"
- "í¬ê´„ì„ê¸ˆì— í¬í•¨ë˜ëŠ” ì‹œê°„ ì™¸ì˜ ì¶”ê°€ ê·¼ë¡œì— ëŒ€í•´ì„œë„ ë³„ë„ì˜ ìˆ˜ë‹¹ì„ ì²­êµ¬í•˜ì§€ ì•ŠëŠ”ë‹¤"
- "íšŒì‚¬ ì •ì±…ìƒ ì¶”ê°€ ìˆ˜ë‹¹ì€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©°, ê·¼ë¡œìëŠ” ì´ì— ë™ì˜í•œë‹¤"
- "ì‹¤ì œ ê·¼ë¡œì‹œê°„ì´ í¬ê´„ì„ê¸ˆì— í¬í•¨ëœ ì‹œê°„ì„ ì´ˆê³¼í•˜ë”ë¼ë„, ì¶”ê°€ ìˆ˜ë‹¹ì„ ì²­êµ¬í•˜ì§€ ì•Šê¸°ë¡œ í•©ì˜"

ì´ì™€ ìœ ì‚¬í•œ ë¬¸êµ¬ë¥¼ ë°œê²¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬í•˜ë¼:

1) ë°˜ë“œì‹œ issues ë°°ì—´ì— ë³„ë„ í•­ëª©ìœ¼ë¡œ ì¶”ê°€í•œë‹¤.
   - category: "wage" ë˜ëŠ” "working_hours"
   - severity: í•­ìƒ "high"
   - summary: "ë²•ì • ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ìˆ˜ë‹¹ ë“± ì„ê¸ˆ ì²­êµ¬ê¶Œì„ ì‚¬ì „ì— í¬ê¸°ì‹œí‚¤ëŠ” ì¡°í•­"
   - reason/rationale: í¬ê´„ì„ê¸ˆì œ ê³„ì•½ì„ ì²´ê²°í–ˆë”ë¼ë„, ì‹¤ì œ ê·¼ë¡œì‹œê°„ì„ ì‚°ì •í•˜ì—¬ ë²•ì • ìˆ˜ë‹¹(ì—°ì¥, ì•¼ê°„, íœ´ì¼)ì´ í¬ê´„ì„ê¸ˆì•¡ì„ ì´ˆê³¼í•  ê²½ìš° ì°¨ì•¡ì„ ì§€ê¸‰í•´ì•¼ í•  ì˜ë¬´ê°€ ìˆìŒ. "ì²­êµ¬í•˜ì§€ ì•Šê¸°ë¡œ í•©ì˜"ëŠ” ê·¼ë¡œê¸°ì¤€ë²• ì œ15ì¡° ìœ„ë°˜ìœ¼ë¡œ ë¬´íš¨ì´ë©°, ì„ê¸ˆ ì²´ë¶ˆ ì†Œì§€ê°€ í¼.

2) legal_basisì—ëŠ” ìµœì†Œ ë‹¤ìŒ ë‚´ìš©ì„ í¬í•¨í•œë‹¤.
   - "ê·¼ë¡œê¸°ì¤€ë²• ì œ15ì¡°: ì´ ë²•ì—ì„œ ì •í•œ ê¸°ì¤€ì— ë¯¸ì¹˜ì§€ ëª»í•˜ëŠ” ê·¼ë¡œì¡°ê±´ì„ ì •í•œ ê·¼ë¡œê³„ì•½ ë¶€ë¶„ì€ ë¬´íš¨ì´ë©°, ê·¸ ë¬´íš¨ ë¶€ë¶„ì€ ì´ ë²•ì—ì„œ ì •í•œ ê¸°ì¤€ì— ë”°ë¥¸ë‹¤."
   - "ê·¼ë¡œê¸°ì¤€ë²• ì œ56ì¡°: ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ê·¼ë¡œì— ëŒ€í•œ ê°€ì‚°ìˆ˜ë‹¹ ì§€ê¸‰ ì˜ë¬´"

3) risk_scoreì™€ risk_level ì‚°ì • ì‹œ, ì´ëŸ¬í•œ ì¡°í•­ì´ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ì „ì²´ ê³„ì•½ì„œ risk_levelì€ ìµœì†Œ "medium", ë³´í†µì€ "high" ìˆ˜ì¤€ìœ¼ë¡œ í‰ê°€í•œë‹¤.

[í•´ì•¼ í•  ì¼]

1. ê° clauseë¥¼ ìœ„ 9ê°œ í•­ëª© ê´€ì ì—ì„œ ê²€í† í•˜ì—¬ ë¬¸ì œê°€ ë˜ëŠ” ì¡°í•­ì„ ì°¾ìŠµë‹ˆë‹¤.
2. ë…ì†Œì¡°í•­ í›„ë³´ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì‹ë³„í•©ë‹ˆë‹¤.
3. ì´ìŠˆë§ˆë‹¤ ì–´ëŠ clauseì— í•´ë‹¹í•˜ëŠ”ì§€ "clause_id"ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
4. ë°˜ë“œì‹œ ë‚´ê°€ ì œê³µí•œ clause_idë§Œ ì‚¬ìš©í•´ì•¼ í•˜ë©°, ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ 'ì›ë¬¸'ì¸ ê²ƒì²˜ëŸ¼ ì“°ì§€ ë§ˆì‹­ì‹œì˜¤.
5. í•œ clauseì—ì„œ ì—¬ëŸ¬ ê°œì˜ ë¬¸ì œê°€ ë°œê²¬ë˜ë©´, ê°™ì€ clause_idë¡œ ì—¬ëŸ¬ ì´ìŠˆë¥¼ ìƒì„±í•´ë„ ë©ë‹ˆë‹¤.
6. JSON í˜•ì‹ë§Œ ì¶œë ¥í•©ë‹ˆë‹¤.
7. **ë°˜ë“œì‹œ issues ë°°ì—´ì— ìµœì†Œ 1ê°œ ì´ìƒì˜ ì´ìŠˆë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.** ê³„ì•½ì„œì— ë¬¸ì œê°€ ì—†ì–´ ë³´ì—¬ë„, ìµœì†Œí•œ 1ê°œì˜ ì´ìŠˆ(ì˜ˆ: "ì„ê¸ˆ êµ¬ì„± ëª…í™•ì„± í™•ì¸ í•„ìš”")ë¥¼ ìƒì„±í•˜ì„¸ìš”.
8. issues ë°°ì—´ì´ ë¹„ì–´ìˆìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤. ë¹ˆ ë°°ì—´ []ì„ ë°˜í™˜í•˜ì§€ ë§ˆì„¸ìš”.

[ì¶œë ¥ í˜•ì‹]

ì•„ë˜ JSON ìŠ¤í‚¤ë§ˆë¥¼ ì§€í‚¤ì„¸ìš”.

{{
  "risk_score": 0-100,
  "risk_level": "low" | "medium" | "high",
  "summary": "ê³„ì•½ì„œ ì „ì²´ ìœ„í—˜ë„ì— ëŒ€í•œ í•œ ì¤„ ìš”ì•½ (í•œêµ­ì–´)",
  "one_line_summary": "ì„(í”„ë¦¬ëœì„œ/ê·¼ë¡œì)ì—ê²Œ ë¶ˆë¦¬í•œ ì¡°í•­ì´ Nê°œ ìˆìœ¼ë©°, íŠ¹íˆ [ì£¼ìš” ë¬¸ì œ]ê°€ ê³¼ë„í•œ í¸ì…ë‹ˆë‹¤. í˜‘ì˜Â·ìˆ˜ì • ì—†ì´ ê·¸ëŒ€ë¡œ ì„œëª…í•˜ëŠ” ê²ƒì€ ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
  "risk_traffic_light": "ğŸŸ¢ | ğŸŸ¡ | ğŸ”´",
  "top3_action_points": [
    "ì§€ê¸ˆ ë‹¹ì¥ í™•ì¸í•˜ê±°ë‚˜ ë¬¼ì–´ë´ì•¼ í•  í¬ì¸íŠ¸ 1",
    "ì§€ê¸ˆ ë‹¹ì¥ í™•ì¸í•˜ê±°ë‚˜ ë¬¼ì–´ë´ì•¼ í•  í¬ì¸íŠ¸ 2",
    "ì§€ê¸ˆ ë‹¹ì¥ í™•ì¸í•˜ê±°ë‚˜ ë¬¼ì–´ë´ì•¼ í•  í¬ì¸íŠ¸ 3"
  ],
  "risk_summary_table": [
    {{
      "item": "ëŒ€ê¸ˆ ì§€ê¸‰",
      "risk_level": "low | medium | high",
      "problem_point": "ê²€ìˆ˜ í›„ ì§€ê¸‰, ê¸°í•œ ì—†ìŒ",
      "simple_explanation": "ê°‘ì´ ë¬´ê¸°í•œ ê²€ìˆ˜ ì§€ì—° ê°€ëŠ¥",
      "revision_keyword": "ê²€ìˆ˜ í›„ â—‹ì¼ ì´ë‚´ ì§€ê¸‰ ëª…ì‹œ"
    }}
  ],
  "issues": [
    {{
      "issue_id": "ë¬¸ìì—´, ì˜ˆ: issue-1",
      "clause_id": "clause-ë²ˆí˜¸ (ë°˜ë“œì‹œ ìœ„ ëª©ë¡ì— ìˆëŠ” ê²ƒë§Œ ì‚¬ìš©)",
      "category": "wage | working_hours | job_stability | dismissal | payment | ip | nda | non_compete | liability | dispute",
      "severity": "low | medium | high",
      "summary": "ì´ìŠˆë¥¼ í•œ ì¤„ë¡œ ìš”ì•½ (í•œêµ­ì–´)",
      "reason": "ì™œ ë¬¸ì œê°€ ë˜ëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª… (í•œêµ­ì–´)",
      "legal_basis": ["ê´€ë ¨ ë²•ì¡°í•­ ë˜ëŠ” ê°€ì´ë“œë¼ì¸"],
      "suggested_revision": "ê°€ëŠ¥í•˜ë‹¤ë©´ ë” ì•ˆì „í•œ ë¬¸êµ¬ ì œì•ˆ (í•œêµ­ì–´)",
      "suggested_questions": ["ì‚¬ì—…ì£¼ì—ê²Œ í™•ì¸í•´ë³¼ ì§ˆë¬¸ ëª©ë¡ (í•œêµ­ì–´)"],
      "toxic_clause_detail": {{
        "clause_location": "ì œâ—‹ì¡°(ì†í•´ë°°ìƒ)",
        "content_summary": "ë‚´ìš© ìš”ì•½",
        "why_risky": "ì™œ ìœ„í—˜í•œì§€",
        "real_world_problems": "í˜„ì‹¤ì—ì„œ ìƒê¸¸ ìˆ˜ ìˆëŠ” ë¬¸ì œ",
        "suggested_revision_light": "ë¼ì´íŠ¸ ë²„ì „ ìˆ˜ì • ì œì•ˆ (ì¼ë°˜ì¸ ë§íˆ¬)",
        "suggested_revision_formal": "í¬ë©€ ë²„ì „ ìˆ˜ì • ì œì•ˆ (ë¡œíŒ/ë³€í˜¸ì‚¬ìš©)"
      }}
    }}
  ],
  "toxic_clauses": [
    {{
      "clause_location": "ì œâ—‹ì¡°(ì†í•´ë°°ìƒ)",
      "content_summary": "ë‚´ìš© ìš”ì•½",
      "why_risky": "ì™œ ìœ„í—˜í•œì§€",
      "real_world_problems": "í˜„ì‹¤ì—ì„œ ìƒê¸¸ ìˆ˜ ìˆëŠ” ë¬¸ì œ",
      "suggested_revision_light": "ë¼ì´íŠ¸ ë²„ì „ ìˆ˜ì • ì œì•ˆ",
      "suggested_revision_formal": "í¬ë©€ ë²„ì „ ìˆ˜ì • ì œì•ˆ"
    }}
  ],
  "negotiation_questions": [
    "ê²€ìˆ˜ ê¸°ê°„ì„ ìµœëŒ€ â—‹ì¼ë¡œ ì œí•œí•  ìˆ˜ ìˆì„ê¹Œìš”?",
    "ì§€ì—° ì‹œ ì§€ì—°ì´ì/ì§€ê¸‰ ê¸°í•œì„ ëª…ì‹œí•´ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?",
    "ì†í•´ë°°ìƒ í•œë„ë¥¼ 'ì´ ê³„ì•½ê¸ˆì•¡' ìˆ˜ì¤€ìœ¼ë¡œ ì œí•œí•  ìˆ˜ ìˆì„ê¹Œìš”?"
  ],
  "recommendations": [
    "ì „ë°˜ì ì¸ ê°œì„  ê¶Œê³ ì‚¬í•­ (í•œêµ­ì–´)"
  ]
}}

[ì¤‘ìš” ê·œì¹™]

- 'original_text' í•„ë“œë¥¼ ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”. ì›ë¬¸ í…ìŠ¤íŠ¸ëŠ” ë‚´ê°€ clause_idë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë”°ë¡œ ì°¾ìŠµë‹ˆë‹¤.
- clause.contentë¥¼ ë‹¤ì‹œ ì¨ì„œ ìš”ì•½í•˜ëŠ” ëŒ€ì‹ , ì™œ ìœ„í—˜í•œì§€ ì„¤ëª…ì— ì§‘ì¤‘í•˜ì‹­ì‹œì˜¤.
- ë…ì†Œì¡°í•­ì€ toxic_clause_detail í•„ë“œì— ìƒì„¸ ì •ë³´ë¥¼ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”.
- JSONë§Œ ì¶œë ¥í•˜ê³ , ë‹¤ë¥¸ ì„¤ëª… í…ìŠ¤íŠ¸ëŠ” ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”.
- risk_score: 0-30(low), 31-60(medium), 61-100(high)
- issues ìµœëŒ€ 15ê°œê¹Œì§€, ìš°ì„ ìˆœìœ„ ë†’ì€ ê²ƒë¶€í„° (ë…ì†Œì¡°í•­ ìš°ì„ )
- ë…ì†Œì¡°í•­ì€ toxic_clauses ë°°ì—´ì—ë„ ë³„ë„ë¡œ ì •ë¦¬í•˜ì„¸ìš”.
"""
    
    prompt = f"""{system_prompt}

{user_prompt}"""
    
    # ì‹¤ì œ ì‚¬ìš©ëœ legal_chunks ê°œìˆ˜ ê³„ì‚°
    used_legal_chunks = min(len(grounding_chunks), 15) if grounding_chunks else 0
    logger.info(f"[í”„ë¡¬í”„íŠ¸ ìƒì„±] clause ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ: clauses={len(clauses)}ê°œ, legal_chunks={len(grounding_chunks) if grounding_chunks else 0}ê°œ ê²€ìƒ‰ë¨, {used_legal_chunks}ê°œ í”„ë¡¬í”„íŠ¸ì— ì‚¬ìš©")
    
    return prompt


# ============================================================================
# ìƒí™© ë¶„ì„ í”„ë¡¬í”„íŠ¸
# ============================================================================

SITUATION_ANALYSIS_SYSTEM_PROMPT = """ë‹¹ì‹ ì€ í•œêµ­ ë…¸ë™ë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìƒí™©ì„ ë¶„ì„í•˜ì—¬ ë²•ì  ë¦¬ìŠ¤í¬ì™€ ëŒ€ì‘ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.

**ë¶„ì„ ì›ì¹™:**
1. ì œê³µëœ ìƒí™© ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë²•ì  ë¦¬ìŠ¤í¬ í‰ê°€
2. ê´€ë ¨ ë²•ë ¹ì„ ê·¼ê±°ë¡œ ì„¤ëª…
3. ì‹¤ë¬´ì ì¸ ëŒ€ì‘ ë°©ì•ˆê³¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì œì‹œ
4. ìœ ì‚¬ ì¼€ì´ìŠ¤ì™€ ë¹„êµ ë¶„ì„
"""


# ============================================================================
# ìƒí™© ë¶„ì„ ë‹¨ê³„ë³„ í”„ë¡¬í”„íŠ¸ (LangGraph ì›Œí¬í”Œë¡œìš°ìš©)
# ============================================================================

def build_situation_classify_prompt(
    situation_text: str,
    category_hint: Optional[str] = None,
    employment_type: Optional[str] = None,
    work_period: Optional[str] = None,
    weekly_hours: Optional[int] = None,
    is_probation: Optional[bool] = None,
    social_insurance: Optional[str] = None,
) -> str:
    """
    ìƒí™© ë¶„ë¥˜ìš© í”„ë¡¬í”„íŠ¸ (1ë‹¨ê³„: ë¶„ë¥˜)
    
    Returns:
        ë¶„ë¥˜ ê²°ê³¼ JSON: {classified_type, risk_score, categories}
    """
    user_info = []
    if employment_type:
        user_info.append(f"ê³ ìš© í˜•íƒœ: {employment_type}")
    if work_period:
        user_info.append(f"ê·¼ë¬´ ê¸°ê°„: {work_period}")
    if weekly_hours:
        user_info.append(f"ì£¼ë‹¹ ê·¼ë¡œì‹œê°„: {weekly_hours}ì‹œê°„")
    if is_probation is not None:
        user_info.append(f"ìˆ˜ìŠµ ì—¬ë¶€: {'ìˆ˜ìŠµ ì¤‘' if is_probation else 'ìˆ˜ìŠµ ì•„ë‹˜'}")
    if social_insurance:
        user_info.append(f"4ëŒ€ë³´í—˜: {social_insurance}")
    user_info_text = "\n".join(user_info) if user_info else "ì •ë³´ ì—†ìŒ"
    
    category_labels = {
        "harassment": "ì§ì¥ ë‚´ ê´´ë¡­í˜ / ëª¨ìš•",
        "unpaid_wage": "ì„ê¸ˆì²´ë¶ˆ / ìˆ˜ë‹¹ ë¯¸ì§€ê¸‰",
        "unfair_dismissal": "ë¶€ë‹¹í•´ê³  / ê³„ì•½í•´ì§€",
        "overtime": "ê·¼ë¡œì‹œê°„ / ì•¼ê·¼ / íœ´ê²Œì‹œê°„ ë¬¸ì œ",
        "probation": "ìˆ˜ìŠµÂ·ì¸í„´ ê´€ë ¨ ë¬¸ì œ",
        "unknown": "ê¸°íƒ€ / ì˜ ëª¨ë¥´ê² ìŒ",
    }
    category_label = category_labels.get(category_hint, category_hint) if category_hint else ""
    
    prompt = f"""ë‹¹ì‹ ì€ í•œêµ­ ë…¸ë™ë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìƒí™©ì„ ë¶„ì„í•˜ì—¬ ì¹´í…Œê³ ë¦¬ì™€ ìœ„í—˜ë„ë¥¼ ë¶„ë¥˜í•˜ì„¸ìš”.

**ì‚¬ìš©ì ì •ë³´:**
{user_info_text}

**ìƒí™© ì¹´í…Œê³ ë¦¬ íŒíŠ¸:** {category_label}

**ìƒí™© ì„¤ëª…:**
{situation_text}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ë¶„ë¥˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ì„¸ìš”:
{{
    "classified_type": "harassment",
    "risk_score": 0~100 ì‚¬ì´ì˜ ìˆ«ì,
    "categories": ["ê´€ë ¨ ë²•ë ¹ ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ëª©ë¡", "ì˜ˆ: ì„ê¸ˆì²´ë¶ˆ", "ìµœì €ì„ê¸ˆ", "ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹"]
}}

**ë¶„ë¥˜ ê¸°ì¤€:**
- classified_type: ìƒí™©ì˜ ì£¼ìš” ìœ í˜•ì„ **ë°˜ë“œì‹œ í•˜ë‚˜ë§Œ** ì„ íƒ (harassment, unpaid_wage, unfair_dismissal, overtime, probation, unknown ì¤‘ í•˜ë‚˜)
- risk_score: ë²•ì  ìœ„í—˜ë„ (0-100, ë†’ì„ìˆ˜ë¡ ìœ„í—˜)
- categories: ê²€ìƒ‰ì— ì‚¬ìš©í•  ë²•ë ¹ ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ëª©ë¡ (3-5ê°œ)

JSON í˜•ì‹ë§Œ ë°˜í™˜í•˜ì„¸ìš”.
"""
    return prompt


def build_situation_rule_filter_prompt(
    classified_type: str,
    categories: List[str],
    situation_text: str,
) -> str:
    """
    ê·œì • í•„í„°ë§ìš© í”„ë¡¬í”„íŠ¸ (2ë‹¨ê³„: ê·œì • í•„í„°ë§)
    
    Returns:
        í•„í„°ë§ëœ ì¹´í…Œê³ ë¦¬ ëª©ë¡
    """
    # í˜„ì¬ëŠ” ê°„ë‹¨í•œ ë§¤í•‘ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ í”„ë¡¬í”„íŠ¸ëŠ” ì„ íƒì‚¬í•­
    # í•„ìš”ì‹œ LLMìœ¼ë¡œ ë” ì •êµí•œ í•„í„°ë§ ê°€ëŠ¥
    prompt = f"""ë‹¤ìŒ ë¶„ë¥˜ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê²€ìƒ‰í•  ë²•ë ¹ ì¹´í…Œê³ ë¦¬ë¥¼ í•„í„°ë§í•˜ì„¸ìš”.

**ë¶„ë¥˜ ìœ í˜•:** {classified_type}
**ì œì•ˆëœ ì¹´í…Œê³ ë¦¬:** {', '.join(categories)}

**ìƒí™© ì„¤ëª…:**
{situation_text}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ í•„í„°ë§ëœ ì¹´í…Œê³ ë¦¬ ëª©ë¡ì„ ë°˜í™˜í•˜ì„¸ìš”:
{{
    "filtered_categories": ["ìµœì¢… ê²€ìƒ‰ì— ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ëª©ë¡"]
}}

JSON í˜•ì‹ë§Œ ë°˜í™˜í•˜ì„¸ìš”.
"""
    return prompt


def build_situation_action_guide_prompt(
    situation_text: str,
    classification: Dict[str, Any],
    grounding_chunks: List[Any],
    legal_basis: List[Dict[str, Any]] = None,
    employment_type: Optional[str] = None,
    work_period: Optional[str] = None,
    weekly_hours: Optional[int] = None,
    is_probation: Optional[bool] = None,
    social_insurance: Optional[str] = None,
) -> str:
    """
    í–‰ë™ ê°€ì´ë“œ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸ (5ë‹¨ê³„: ì•¡ì…˜ ê°€ì´ë“œ)
    
    Returns:
        ì•¡ì…˜ ê°€ì´ë“œ JSON: {summary, criteria, action_plan, scripts}
        - summary: 4ê°œ ì„¹ì…˜ ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸
        - criteria: ë²•ì  íŒë‹¨ ê¸°ì¤€ (legal_basis ê¸°ë°˜)
        - action_plan: steps êµ¬ì¡°
        - scripts: to_company, to_advisor
    """
    # ê´€ë ¨ ë²•ë ¹ ì»¨í…ìŠ¤íŠ¸
    legal_context = ""
    if grounding_chunks:
        legal_context = "\n**ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸:**\n"
        for chunk in grounding_chunks[:8]:
            source_type = getattr(chunk, 'source_type', 'law')
            title = getattr(chunk, 'title', '')
            snippet = getattr(chunk, 'snippet', getattr(chunk, 'content', ''))[:300]
            legal_context += f"- [{source_type}] {title}: {snippet}\n"
    
    # legal_basis ì •ë³´
    legal_basis_text = ""
    if legal_basis:
        legal_basis_text = "\n**ë²•ì  ê·¼ê±° (criteria ìƒì„±ìš©):**\n"
        for basis in legal_basis[:5]:
            title = basis.get('title', '')
            snippet = basis.get('snippet', '')
            source_type = basis.get('source_type', 'law')
            legal_basis_text += f"- {title} ({source_type}): {snippet[:200]}\n"
    
    user_info = []
    if employment_type:
        user_info.append(f"ê³ ìš© í˜•íƒœ: {employment_type}")
    if work_period:
        user_info.append(f"ê·¼ë¬´ ê¸°ê°„: {work_period}")
    if weekly_hours:
        user_info.append(f"ì£¼ë‹¹ ê·¼ë¡œì‹œê°„: {weekly_hours}ì‹œê°„")
    if is_probation is not None:
        user_info.append(f"ìˆ˜ìŠµ ì—¬ë¶€: {'ìˆ˜ìŠµ ì¤‘' if is_probation else 'ìˆ˜ìŠµ ì•„ë‹˜'}")
    if social_insurance:
        user_info.append(f"4ëŒ€ë³´í—˜: {social_insurance}")
    user_info_text = "\n".join(user_info) if user_info else "ì •ë³´ ì—†ìŒ"
    
    prompt = f"""ë‹¹ì‹ ì€ í•œêµ­ ë…¸ë™ë²• ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìƒí™©ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬ì²´ì ì¸ í–‰ë™ ê°€ì´ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”.

**ì‚¬ìš©ì ì •ë³´:**
{user_info_text}

**ë¶„ë¥˜ ê²°ê³¼:**
- ìœ í˜•: {classification.get('classified_type', 'unknown')}
- ìœ„í—˜ë„: {classification.get('risk_score', 50)}ì 

**ìƒí™© ì„¤ëª…:**
{situation_text}
{legal_context}
{legal_basis_text}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ í–‰ë™ ê°€ì´ë“œë¥¼ ë°˜í™˜í•˜ì„¸ìš”:
{{
    "summary": "ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ë¦¬í¬íŠ¸ (ì•„ë˜ 4ê°œ ì„¹ì…˜ì„ ì •í™•í•œ í˜•ì‹ìœ¼ë¡œ í•„ìˆ˜ í¬í•¨)",
    "criteria": [
        {{
            "name": "íŒë‹¨ ê¸°ì¤€ëª…",
            "status": "likely|unclear|unlikely",
            "reason": "íŒë‹¨ ì´ìœ  ë° ì„¤ëª…"
        }}
    ],
    "action_plan": {{
        "steps": [
            {{
                "title": "ì¦ê±° ìˆ˜ì§‘",
                "items": ["êµ¬ì²´ì ì¸ ì¦ê±° ìˆ˜ì§‘ ë°©ë²• 1", "êµ¬ì²´ì ì¸ ì¦ê±° ìˆ˜ì§‘ ë°©ë²• 2"]
            }},
            {{
                "title": "1ì°¨ ëŒ€ì‘",
                "items": ["ì´ˆê¸° ëŒ€ì‘ ë°©ë²• 1", "ì´ˆê¸° ëŒ€ì‘ ë°©ë²• 2"]
            }},
            {{
                "title": "ìƒë‹´/ì‹ ê³  ë£¨íŠ¸",
                "items": ["ê³ ìš©ë…¸ë™ë¶€ 1350 ìƒë‹´ì„¼í„°", "ì²­ë…„ë…¸ë™ì„¼í„°", "ë…¸ë¬´ì‚¬ ìƒë‹´"]
            }}
        ]
    }},
    "scripts": {{
        "to_company": "íšŒì‚¬ì— ë³´ë‚¼ ì •ì¤‘í•œ ë¬¸ì œ ì œê¸° ë¬¸êµ¬ í…œí”Œë¦¿ (ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ë¬¸ì¥)",
        "to_advisor": "ë…¸ë¬´ì‚¬/ê¸°ê´€ì— ìƒë‹´í•  ë•Œ ì“¸ ì„¤ëª… í…œí”Œë¦¿ (ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ë¬¸ì¥)"
    }},
    "organizations": [
        {{
            "id": "moel",
            "name": "ë…¸ë™ì²­",
            "description": "ì²´ë¶ˆì„ê¸ˆ ì¡°ì‚¬ ë° ì‹œì • ëª…ë ¹, ê·¼ë¡œê¸°ì¤€ë²• ìœ„ë°˜ ì¡°ì‚¬",
            "capabilities": ["ì²´ë¶ˆì„ê¸ˆ ì¡°ì‚¬", "ì‹œì • ëª…ë ¹", "ê·¼ë¡œê¸°ì¤€ë²• ìœ„ë°˜ ì¡°ì‚¬"],
            "requiredDocs": ["ê·¼ë¡œê³„ì•½ì„œ", "ì¶œí‡´ê·¼ ê¸°ë¡", "ê¸‰ì—¬ëª…ì„¸ì„œ"],
            "legalBasis": "ê·¼ë¡œê¸°ì¤€ë²• ì œ110ì¡°: ê·¼ë¡œê°ë…ê´€ì˜ ê¶Œí•œ",
            "website": "https://www.moel.go.kr",
            "phone": "1350"
        }},
        {{
            "id": "labor_attorney",
            "name": "ë…¸ë¬´ì‚¬",
            "description": "ìƒë‹´ ë° ì†Œì†¡ ëŒ€ë¦¬, ê·¼ë¡œ ë¶„ìŸ í•´ê²° ì „ë¬¸",
            "capabilities": ["ìƒë‹´", "ì†Œì†¡ ëŒ€ë¦¬", "ê·¼ë¡œ ë¶„ìŸ í•´ê²°"],
            "requiredDocs": ["ê·¼ë¡œê³„ì•½ì„œ", "ë¬¸ì/ì¹´í†¡ ëŒ€í™”", "ê¸°íƒ€ ì¦ê±° ìë£Œ"],
            "legalBasis": "ë…¸ë¬´ì‚¬ë²•: ê·¼ë¡œ ë¶„ìŸ ì „ë¬¸ ë²•ë¥  ì„œë¹„ìŠ¤"
        }}
    ]
}}

**âš ï¸ ë§¤ìš° ì¤‘ìš”í•œ ì§€ì‹œì‚¬í•­:**

**RAG ê²€ìƒ‰ ê²°ê³¼ í™œìš© í•„ìˆ˜:**
- ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì— ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì€ ì‹¤ì œë¡œ ê²€ìƒ‰ëœ ë¬¸ì„œì…ë‹ˆë‹¤.
- **ë°˜ë“œì‹œ ì´ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ** ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•˜ë©°, ì¼ë°˜ì ì¸ ë²•ë ¹ ì§€ì‹ë§Œìœ¼ë¡œ ì‘ì„±í•˜ì§€ ë§ˆì„¸ìš”.
- "ë²•ì  ê´€ì ì—ì„œ ë³¸ í˜„ì¬ìƒí™©" ì„¹ì…˜ì—ì„œëŠ” ì œê³µëœ ë²•ë ¹ì˜ ì œëª©ê³¼ í•µì‹¬ ë‚´ìš©ì„ ëª…ì‹œì ìœ¼ë¡œ ì¸ìš©í•˜ì„¸ìš”.

**âš ï¸ ë§¤ìš° ì¤‘ìš”: ì‚¬ìš©ì ì¹œí™”ì ì¸ ì„¤ëª… ë³€í™˜ í•„ìˆ˜:**
- RAGë¡œ ê²€ìƒ‰ëœ ì›ë¬¸(snippet)ì„ ê·¸ëŒ€ë¡œ ë‚˜ì—´í•˜ì§€ ë§ˆì„¸ìš”.
- ê²€ìƒ‰ëœ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ **"ì‚¬ìš©ìì—ê²Œ ê±´ë„¤ëŠ” ë§"**ë¡œ ë³€í™˜í•˜ì—¬ ì„¤ëª…í•˜ì„¸ìš”.
- **ë²• ì¡°í•­ì„ ê·¸ëŒ€ë¡œ ìŠì§€ ë§ê³ , '~í•´ì•¼ í•©ë‹ˆë‹¤' ì²´ì˜ í•µì‹¬ ìš”ì•½ í•œ ë¬¸ì¥ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.**
- ì˜ˆì‹œ:
  - âŒ ë‚˜ìœ ì˜ˆ: "íšŒì‚¬ëŠ” ê·¼ë¡œê³„ì•½ ì²´ê²° ì‹œ ì œ1í•­ì˜ ì¼ë¶€ ë‚´ìš©ì„ ëŒ€ì‹ í•˜ê¸° ìœ„í•œ ê²ƒì„ì„ ëª…í™•íˆ ë°íˆë©´ì„œ... ì œ7ì¡°(ìˆ˜ìŠµê¸°ê°„)..."
  - âœ… ì¢‹ì€ ì˜ˆ: "í‘œì¤€ ì·¨ì—…ê·œì¹™ì— ë”°ë¥´ë©´, ìˆ˜ìŠµê¸°ê°„ì€ ê·¼ë¡œê³„ì•½ì„œì— ëª…í™•íˆ ê¸°ì¬ë˜ì–´ì•¼ íš¨ë ¥ì´ ìˆìŠµë‹ˆë‹¤. êµ¬ë‘ë¡œë§Œ í•©ì˜ëœ ìˆ˜ìŠµê¸°ê°„ì€ ì¸ì •ë°›ê¸° ì–´ë µìŠµë‹ˆë‹¤."
- ë²•ì¡°ë¬¸ ë²ˆí˜¸(ì œ1í•­, ì œ7ì¡° ë“±)ë‚˜ ë¬¸ì„œ í˜•ì‹ì ì¸ ì„¤ëª…ì„ ë‚˜ì—´í•˜ì§€ ë§ê³ , **"í•´ì•¼ í•  í–‰ë™"ì´ë‚˜ "ê¶Œë¦¬" ì¤‘ì‹¬ìœ¼ë¡œ ì‰½ê²Œ í’€ì–´ì„œ** ì‘ì„±í•˜ì„¸ìš”.
- ë¬¸ì¥ì´ ë”±ë”±í•˜ê±°ë‚˜ ì¤‘ê°„ì— ì¡°ì‚¬ë‚˜ ë„ì–´ì“°ê¸°ê°€ ì–´ìƒ‰í•œ ê²½ìš°, ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¡œ ì¬ì‘ì„±í•˜ì„¸ìš”.
- ì‚¬ìš©ìê°€ ë°”ë¡œ ì´í•´í•˜ê³  í–‰ë™ì— ì˜®ê¸¸ ìˆ˜ ìˆë„ë¡ êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ì„¤ëª…ì„ ì œê³µí•˜ì„¸ìš”.

1. **summary í•„ë“œ (í•„ìˆ˜):**
   **âš ï¸ ë§¤ìš° ì¤‘ìš”: summary í•„ë“œëŠ” ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì„¹ì…˜ ì œëª©(í—¤ë”) ë¬¸ìì—´ì€ ì •í™•íˆ ìœ„ì™€ ë˜‘ê°™ì´ ì¨ì•¼ í•©ë‹ˆë‹¤.**
   
   **ë°˜ë“œì‹œ ë‹¤ìŒ 4ê°œ ì„¹ì…˜ì„ ì •í™•í•œ í˜•ì‹ìœ¼ë¡œ ìˆœì„œëŒ€ë¡œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:**
   
   ```markdown
   ## ğŸ“Š ìƒí™© ë¶„ì„ì˜ ê²°ê³¼
   
   [ì—¬ê¸°ì— ì œê³µëœ ìƒí™©ì„ ë°”íƒ•ìœ¼ë¡œ í•µì‹¬ ë¬¸ì œì ê³¼ ìœ„í—˜ë„ë¥¼ ìš”ì•½í•˜ì—¬ 2-3ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…]
   
   ## âš–ï¸ ë²•ì  ê´€ì ì—ì„œ ë³¸ í˜„ì¬ìƒí™©
   
   [**ë°˜ë“œì‹œ ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì—ì„œ ì œê³µëœ ë²•ë ¹ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¸ìš©í•˜ì—¬** í˜„ì¬ ìƒí™©ì´ ë²•ì ìœ¼ë¡œ ì–´ë–»ê²Œ í‰ê°€ë˜ëŠ”ì§€ ì„¤ëª…. 
   - ì œê³µëœ ë²•ë ¹ì˜ ì œëª©, ì¡°í•­ ë²ˆí˜¸, í•µì‹¬ ë‚´ìš©ì„ ëª…ì‹œì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì„¸ìš”
   - ì¼ë°˜ì ì¸ ë²•ë ¹ ì§€ì‹ì´ ì•„ë‹Œ, ì‹¤ì œë¡œ ê²€ìƒ‰ëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”
   - êµ¬ì²´ì ì¸ ë²•ì  ê·¼ê±°ì™€ íŒë‹¨ ê¸°ì¤€ì„ í¬í•¨í•˜ì—¬ 3-5ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±]
   
   ## ğŸ¯ ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” í–‰ë™
   
   - [ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆ 1]
   - [ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆ 2]
   - [ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆ 3]
   - [ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆ 4]
   
   ## ğŸ’¬ ì´ë ‡ê²Œ ë§í•´ë³´ì„¸ìš”
   
   [íšŒì‚¬ë‚˜ ìƒë‹´ ê¸°ê´€ì— ì‹¤ì œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸êµ¬ í…œí”Œë¦¿ì„ ì œê³µ. ì‹¤ì œ ëŒ€í™”ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±]
   ```
   
   **âš ï¸ ë§¤ìš° ì¤‘ìš” - ì„¹ì…˜ í—¤ë” ì •í™•ì„±:**
   - ì²« ë²ˆì§¸ ì„¹ì…˜: ë°˜ë“œì‹œ `## ğŸ“Š ìƒí™© ë¶„ì„ì˜ ê²°ê³¼` (ì •í™•íˆ ì´ ë¬¸ìì—´)
   - ë‘ ë²ˆì§¸ ì„¹ì…˜: ë°˜ë“œì‹œ `## âš–ï¸ ë²•ì  ê´€ì ì—ì„œ ë³¸ í˜„ì¬ìƒí™©` (ì •í™•íˆ ì´ ë¬¸ìì—´)
   - ì„¸ ë²ˆì§¸ ì„¹ì…˜: ë°˜ë“œì‹œ `## ğŸ¯ ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” í–‰ë™` (ì •í™•íˆ ì´ ë¬¸ìì—´)
   - ë„¤ ë²ˆì§¸ ì„¹ì…˜: ë°˜ë“œì‹œ `## ğŸ’¬ ì´ë ‡ê²Œ ë§í•´ë³´ì„¸ìš”` (ì •í™•íˆ ì´ ë¬¸ìì—´)
   - ì´ëª¨ì§€(ğŸ“Š, âš–ï¸, ğŸ¯, ğŸ’¬)ì™€ ë§ˆí¬ë‹¤ìš´ í—¤ë”(`##`)ë¥¼ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”.
   - ì„¹ì…˜ í—¤ë”ë¥¼ ìƒëµí•˜ê±°ë‚˜ ë‹¤ë¥¸ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì§€ ë§ˆì„¸ìš”.
   - **ë°˜ë“œì‹œ í•œê¸€ë¡œë§Œ ì‘ì„±í•˜ì„¸ìš”. í•œì(æ¼¢å­—), ì¼ë³¸ì–´(ã²ã‚‰ãŒãª, ã‚«ã‚¿ã‚«ãƒŠ), ì¤‘êµ­ì–´ë¥¼ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.**
   - ì˜ˆ: "æœ€è¿‘" âŒ â†’ "ìµœê·¼" âœ…, "å…¸å‹" âŒ â†’ "ì „í˜•" âœ…, "ãƒ‰ãƒ©" âŒ â†’ "í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤" âœ…
   - ëª¨ë“  í…ìŠ¤íŠ¸ëŠ” ìˆœìˆ˜ í•œê¸€ê³¼ ì˜ë¬¸, ìˆ«ì, ê¸°ë³¸ êµ¬ë‘ì ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.

2. **criteria í•„ë“œ (í•„ìˆ˜):**
   - ìœ„ì˜ "ë²•ì  ê·¼ê±°" ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒì„±í•˜ì„¸ìš”.
   - ê° ê¸°ì¤€ì€ legal_basisì˜ í•­ëª©ì„ ì°¸ê³ í•˜ì—¬ {{"name": "ê¸°ì¤€ëª…", "status": "likely|unclear|unlikely", "reason": "íŒë‹¨ ì´ìœ "}} í˜•íƒœë¡œ êµ¬ì„±í•˜ì„¸ìš”.
   - **reason í•„ë“œëŠ” ë°˜ë“œì‹œ ë‹¤ìŒ ë‚´ìš©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:**
     1. ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì—ì„œ ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì˜ ì œëª©ì„ ëª…ì‹œì ìœ¼ë¡œ ì¸ìš© (ã€...ã€ ë˜ëŠ” ã€Œ...ã€ í˜•ì‹)
     2. í•´ë‹¹ ë¬¸ì„œì˜ í•µì‹¬ ë‚´ìš© ìš”ì•½ (1-2ë¬¸ì¥)
     3. í˜„ì¬ ìƒí™©ê³¼ì˜ ì—°ê´€ì„± ë° êµ¬ì²´ì ì¸ íŒë‹¨ ê·¼ê±° (2-3ë¬¸ì¥)
     4. ì™œ ì´ status(likely/unclear/unlikely)ë¡œ íŒë‹¨í–ˆëŠ”ì§€ ì´ìœ 
   - **reason í•„ë“œëŠ” ìµœì†Œ 3ë¬¸ì¥ ì´ìƒìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. ë‹¨ìˆœíˆ "ì— ë”°ë¥´ë©´"ìœ¼ë¡œ ëë‚˜ì§€ ë§ê³ , êµ¬ì²´ì ì¸ ë‚´ìš©ì„ í¬í•¨í•˜ì„¸ìš”.**
   - ì˜ˆì‹œ:
     - âŒ ë‚˜ìœ ì˜ˆ: "'ì§ì¥ ë‚´ ê´´ë¡­í˜ íŒë‹¨ ë° ì˜ˆë°© ëŒ€ì‘ ë§¤ë‰´ì–¼â˜….pdf'ì— ë”°ë¥´ë©´"
     - âœ… ì¢‹ì€ ì˜ˆ: "ã€Œì§ì¥ ë‚´ ê´´ë¡­í˜ íŒë‹¨ ë° ì˜ˆë°© ëŒ€ì‘ ë§¤ë‰´ì–¼â˜….pdfã€ì— ë”°ë¥´ë©´, ì§ì¥ ë‚´ ê´´ë¡­í˜ì€ ì—…ë¬´ìƒ ì§€ìœ„ë‚˜ ê´€ê³„ë¥¼ ì´ìš©í•˜ì—¬ í”¼í•´ ê·¼ë¡œìì—ê²Œ ì‹ ì²´ì Â·ì •ì‹ ì  ê³ í†µì„ ì£¼ëŠ” í–‰ìœ„ë¡œ ì •ì˜ë©ë‹ˆë‹¤. ì œê³µëœ ìƒí™©ì—ì„œ ìƒì‚¬ê°€ ë¶€ë‹¹í•œ ì§€ì‹œì™€ ëª¨ìš•ì  ì–¸í–‰ì„ ë°˜ë³µì ìœ¼ë¡œ í–‰í•œ ê²ƒì€ ì§ì¥ ë‚´ ê´´ë¡­í˜ì— í•´ë‹¹í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. íŠ¹íˆ ë§¤ë‰´ì–¼ì—ì„œ ëª…ì‹œí•œ 'ë°˜ë³µì ì´ê³  ì§€ì†ì ì¸ í–‰ìœ„' ìš”ê±´ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤."
   - ë¬¸ì„œ ì œëª©ì€ ã€...ã€ ë˜ëŠ” ã€Œ...ã€ í˜•ì‹ìœ¼ë¡œ ê°ì‹¸ì„œ ì‘ì„±í•˜ì„¸ìš”.
   - statusëŠ” "likely" (ì¶©ì¡±), "unclear" (ë¶€ë¶„ ì¶©ì¡±), "unlikely" (ë¶ˆì¶©ì¡±) ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
   - 3~5ê°œ ì •ë„ë¡œ êµ¬ì„±í•˜ì„¸ìš”.

3. **action_plan í•„ë“œ (í•„ìˆ˜):**
   - **ë°˜ë“œì‹œ ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì—ì„œ ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì„ ì°¸ê³ í•˜ì—¬** êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆì„ ì œì‹œí•˜ì„¸ìš”.
   - ì˜ˆ: "ê·¼ë¡œê¸°ì¤€ë²• ì œXXì¡°ì— ë”°ë¼..." ë˜ëŠ” "í‘œì¤€ ê·¼ë¡œê³„ì•½ì„œ ê°€ì´ë“œì— ë”°ë¥´ë©´..." ë“± ì‹¤ì œ ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ì¸ìš©í•˜ì„¸ìš”.
   - ë°˜ë“œì‹œ steps ë°°ì—´ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
   - ê° stepì€ {{"title": "ì œëª©", "items": ["í•­ëª©1", "í•­ëª©2"]}} í˜•íƒœì…ë‹ˆë‹¤.
   - itemsëŠ” ë°˜ë“œì‹œ ë¬¸ìì—´ ë°°ì—´ì´ì–´ì•¼ í•˜ë©°, ê° í•­ëª©ì´ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
   - stepsëŠ” 3ë‹¨ê³„ ì •ë„ë¡œ êµ¬ì„±í•˜ì„¸ìš” (ì˜ˆ: ì¦ê±° ìˆ˜ì§‘, 1ì°¨ ëŒ€ì‘, ë²•ì  ì¡°ì¹˜ ì¤€ë¹„).
   - **âš ï¸ ì¤‘ìš”: ì‹ ê³ /ìƒë‹´ ê¸°ê´€ ê´€ë ¨ í–‰ë™ì€ action_planì— í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.**
     - âŒ í¬í•¨í•˜ì§€ ë§ ê²ƒ: "ë…¸ë¬´ì‚¬ì— ìƒë‹´ì„ ìš”ì²­í•©ë‹ˆë‹¤", "ê³ ìš©ë…¸ë™ë¶€ 1350ì— ì‹ ê³ í•©ë‹ˆë‹¤", "ë…¸ë™ê´€ë ¨ê¸°ê´€ì— ìƒë‹´ì„ ìš”ì²­í•©ë‹ˆë‹¤" ë“±
     - âœ… í¬í•¨í•  ê²ƒ: "ì¦ê±° ìë£Œë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤", "ê·¼ë¡œê³„ì•½ì„œë¥¼ í™•ì¸í•©ë‹ˆë‹¤", "íšŒì‚¬ì— ì´ì˜ë¥¼ ì œê¸°í•©ë‹ˆë‹¤", "ë²•ì  ê·¼ê±°ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤" ë“±
     - ì‹ ê³ /ìƒë‹´ ê¸°ê´€ ì•ˆë‚´ëŠ” ë³„ë„ì˜ "ì¶”ì²œ ì‹ ê³ /ìƒë‹´ ì¡°ì¹˜" ì„¹ì…˜ì—ì„œ ë‹¤ë£¨ë¯€ë¡œ, action_planì—ëŠ” ì¦ê±° ìˆ˜ì§‘, ë¬¸ì„œ í™•ì¸, íšŒì‚¬ ëŒ€ì‘ ë“± ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ í–‰ë™ë§Œ í¬í•¨í•˜ì„¸ìš”.

4. **scripts í•„ë“œ (í•„ìˆ˜):**
   - **ë°˜ë“œì‹œ ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì—ì„œ ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì„ ì°¸ê³ í•˜ì—¬** êµ¬ì²´ì ì¸ ë¬¸êµ¬ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
   - to_company: íšŒì‚¬ì— ë³´ë‚¼ ì •ì¤‘í•œ ë¬¸ì œ ì œê¸° ë¬¸êµ¬ (ì‹¤ì œ ë©”ì‹œì§€/ëŒ€í™”ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥)
     - ì œê³µëœ ë²•ë ¹ì˜ ì¡°í•­ ë²ˆí˜¸ë‚˜ ê°€ì´ë“œë¼ì¸ ë‚´ìš©ì„ ì–¸ê¸‰í•˜ì—¬ ë”ìš± ì„¤ë“ë ¥ ìˆê²Œ ì‘ì„±í•˜ì„¸ìš”.
   - to_advisor: ë…¸ë¬´ì‚¬/ê¸°ê´€ì— ìƒë‹´í•  ë•Œ ì“¸ ì„¤ëª… í…œí”Œë¦¿ (ì‹¤ì œ ìƒë‹´ ì‹œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥)
     - ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì„ ì°¸ê³ í•˜ì—¬ êµ¬ì²´ì ì¸ ë²•ì  ê·¼ê±°ë¥¼ í¬í•¨í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.
   - êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.

5. **organizations í•„ë“œ (í•„ìˆ˜):**
   - ìƒí™© ìœ í˜•ì— ë§ëŠ” ì¶”ì²œ ê¸°ê´€ ëª©ë¡ì„ ìƒì„±í•˜ì„¸ìš”.
   - ê° ê¸°ê´€ì€ {{"id": "ê¸°ê´€ID", "name": "ê¸°ê´€ëª…", "description": "ì„¤ëª…", "capabilities": ["ì„œë¹„ìŠ¤1", "ì„œë¹„ìŠ¤2"], "requiredDocs": ["í•„ìš”ìë£Œ1"], "legalBasis": "ë²•ì ê·¼ê±°", "website": "ì›¹ì‚¬ì´íŠ¸URL", "phone": "ì „í™”ë²ˆí˜¸"}} í˜•íƒœì…ë‹ˆë‹¤.
   - ìƒí™© ìœ í˜•ë³„ ì¶”ì²œ ê¸°ê´€:
     - unpaid_wage (ì„ê¸ˆì²´ë¶ˆ): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
     - harassment (ê´´ë¡­í˜): ê³ ìš©ë…¸ë™ë¶€ ê³ ê°ìƒë‹´ì„¼í„°(moel_complaint), êµ­ê°€ì¸ê¶Œìœ„ì›íšŒ(human_rights), ë…¸ë¬´ì‚¬(labor_attorney)
     - unfair_dismissal (ë¶€ë‹¹í•´ê³ ): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
     - overtime (ê·¼ë¡œì‹œê°„): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
     - probation (ìˆ˜ìŠµ): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
     - unknown (ê¸°íƒ€): ë…¸ë¬´ì‚¬(labor_attorney), ë…¸ë™ì²­(moel), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
   - ê° ê¸°ê´€ì˜ ì •ë³´ëŠ” ì •í™•í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”:
     - ë…¸ë™ì²­: id="moel", phone="1350", website="https://www.moel.go.kr"
     - ë…¸ë¬´ì‚¬: id="labor_attorney", phone ì—†ìŒ, website ì—†ìŒ
     - ê·¼ë¡œë³µì§€ê³µë‹¨: id="comwel", phone="1588-0075", website="https://www.comwel.or.kr"
     - ê³ ìš©ë…¸ë™ë¶€ ê³ ê°ìƒë‹´ì„¼í„°: id="moel_complaint", phone="1350", website="https://1350.moel.go.kr/home/hp/main/hpmain.do"
     - êµ­ê°€ì¸ê¶Œìœ„ì›íšŒ: id="human_rights", phone="1331", website="https://www.humanrights.go.kr"
   - 3~5ê°œ ì •ë„ë¡œ êµ¬ì„±í•˜ì„¸ìš”.

**ê¸°íƒ€ ì‚¬í•­:**
- ëª¨ë“  ì‘ë‹µì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- summaryëŠ” ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ê° ì„¹ì…˜ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì„¸ìš”.
- **JSON í˜•ì‹ë§Œ ë°˜í™˜í•˜ì„¸ìš”.**
- **ì¤‘ìš”: summary í•„ë“œì˜ ê°œí–‰ ë¬¸ìëŠ” ë°˜ë“œì‹œ `\\n`ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„í•´ì•¼ í•©ë‹ˆë‹¤.**
  ì˜ˆ: `"summary": "## ì œëª©\\në‚´ìš©\\n\\n## ë‹¤ìŒ ì œëª©"` (ê°œí–‰ì„ `\\n`ìœ¼ë¡œ ë³€í™˜)
"""
    return prompt


def build_situation_analysis_prompt(
    situation_text: str,
    category_hint: str = None,
    grounding_chunks: list = None,
    employment_type: str = None,
    work_period: str = None,
    weekly_hours: int = None,
    is_probation: bool = None,
    social_insurance: str = None,
) -> str:
    """
    ìƒí™© ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    
    Args:
        situation_text: ìƒí™© ì„¤ëª…
        category_hint: ì¹´í…Œê³ ë¦¬ íŒíŠ¸
        grounding_chunks: ê´€ë ¨ ë²•ë ¹ ì²­í¬
        employment_type: ê³ ìš© í˜•íƒœ
        work_period: ê·¼ë¬´ ê¸°ê°„
        weekly_hours: ì£¼ë‹¹ ê·¼ë¡œì‹œê°„
        is_probation: ìˆ˜ìŠµ ì—¬ë¶€
        social_insurance: 4ëŒ€ë³´í—˜
    
    Returns:
        ì™„ì„±ëœ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´
    """
    # ê´€ë ¨ ë²•ë ¹ ì»¨í…ìŠ¤íŠ¸
    legal_context = ""
    if grounding_chunks:
        legal_context = "\n**ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸:**\n"
        for chunk in grounding_chunks[:8]:
            # LegalGroundingChunkëŠ” Pydantic ëª¨ë¸ì´ë¯€ë¡œ getattr ì‚¬ìš©
            source_type = getattr(chunk, 'source_type', 'law')
            title = getattr(chunk, 'title', '')
            snippet = getattr(chunk, 'snippet', getattr(chunk, 'content', ''))[:300]
            legal_context += f"- [{source_type}] {title}: {snippet}\n"
        
        legal_context += "\n**âš ï¸ ì¤‘ìš”: ìœ„ì˜ ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸ ë‚´ìš©ì„ ì°¸ê³ í•˜ë˜, ì›ë¬¸ì„ ê·¸ëŒ€ë¡œ ë‚˜ì—´í•˜ì§€ ë§ê³  ì‚¬ìš©ìì—ê²Œ ê±´ë„¤ëŠ” ë§ë¡œ ë³€í™˜í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.**\n"
    
    # ì‚¬ìš©ì ì •ë³´ ìš”ì•½
    user_info = []
    if employment_type:
        user_info.append(f"ê³ ìš© í˜•íƒœ: {employment_type}")
    if work_period:
        user_info.append(f"ê·¼ë¬´ ê¸°ê°„: {work_period}")
    if weekly_hours:
        user_info.append(f"ì£¼ë‹¹ ê·¼ë¡œì‹œê°„: {weekly_hours}ì‹œê°„")
    if is_probation is not None:
        user_info.append(f"ìˆ˜ìŠµ ì—¬ë¶€: {'ìˆ˜ìŠµ ì¤‘' if is_probation else 'ìˆ˜ìŠµ ì•„ë‹˜'}")
    if social_insurance:
        user_info.append(f"4ëŒ€ë³´í—˜: {social_insurance}")
    user_info_text = "\n".join(user_info) if user_info else "ì •ë³´ ì—†ìŒ"
    
    # ì¹´í…Œê³ ë¦¬ ë¼ë²¨ ë§¤í•‘
    category_labels = {
        "harassment": "ì§ì¥ ë‚´ ê´´ë¡­í˜ / ëª¨ìš•",
        "unpaid_wage": "ì„ê¸ˆì²´ë¶ˆ / ìˆ˜ë‹¹ ë¯¸ì§€ê¸‰",
        "unfair_dismissal": "ë¶€ë‹¹í•´ê³  / ê³„ì•½í•´ì§€",
        "overtime": "ê·¼ë¡œì‹œê°„ / ì•¼ê·¼ / íœ´ê²Œì‹œê°„ ë¬¸ì œ",
        "probation": "ìˆ˜ìŠµÂ·ì¸í„´ ê´€ë ¨ ë¬¸ì œ",
        "unknown": "ê¸°íƒ€ / ì˜ ëª¨ë¥´ê² ìŒ",
    }
    category_label = category_labels.get(category_hint, category_hint) if category_hint else ""
    
    prompt = f"""{SITUATION_ANALYSIS_SYSTEM_PROMPT}

**ì‚¬ìš©ì ì •ë³´:**
{user_info_text}

**ìƒí™© ì¹´í…Œê³ ë¦¬ íŒíŠ¸:** {category_label}

**ìƒí™© ì„¤ëª…:**
{situation_text}
{legal_context}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì§„ë‹¨ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ì„¸ìš”:
{{
    "classified_type": "harassment",
    "risk_score": 0~100 ì‚¬ì´ì˜ ìˆ«ì,
    "summary": "êµ¬ì¡°í™”ëœ ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ (ì•„ë˜ ì§€ì‹œì‚¬í•­ ì°¸ê³ )",
    "criteria": [
        {{
            "name": "íŒë‹¨ ê¸°ì¤€ëª… (ì˜ˆ: 'ì§ì¥ ë‚´ ê´´ë¡­í˜ ìš”ê±´ ì¶©ì¡± ì—¬ë¶€', 'ì„ê¸ˆì²´ë¶ˆ ë²•ì  ìš”ê±´ ì¶©ì¡± ì—¬ë¶€' ë“±)",
            "status": "likely|unclear|unlikely",
            "reason": "ã€Œì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸ ì œëª©ã€ì— ë”°ë¥´ë©´, [ë²•ë ¹ í•µì‹¬ ë‚´ìš© ìš”ì•½ 1-2ë¬¸ì¥]. ì œê³µëœ ìƒí™©ì—ì„œ [í˜„ì¬ ìƒí™©ê³¼ì˜ ì—°ê´€ì„± ë° êµ¬ì²´ì ì¸ íŒë‹¨ ê·¼ê±° 2-3ë¬¸ì¥]. ë”°ë¼ì„œ ì´ ê¸°ì¤€ì€ [status]ë¡œ íŒë‹¨ë©ë‹ˆë‹¤. [ì™œ ì´ statusë¡œ íŒë‹¨í–ˆëŠ”ì§€ êµ¬ì²´ì ì¸ ì´ìœ ]."
        }},
        {{
            "name": "ë‹¤ë¥¸ íŒë‹¨ ê¸°ì¤€ëª…",
            "status": "likely|unclear|unlikely",
            "reason": "ã€Œì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸ ì œëª©ã€ì— ë”°ë¥´ë©´, [ë²•ë ¹ í•µì‹¬ ë‚´ìš© ìš”ì•½ 1-2ë¬¸ì¥]. ì œê³µëœ ìƒí™©ì—ì„œ [í˜„ì¬ ìƒí™©ê³¼ì˜ ì—°ê´€ì„± ë° êµ¬ì²´ì ì¸ íŒë‹¨ ê·¼ê±° 2-3ë¬¸ì¥]. ë”°ë¼ì„œ ì´ ê¸°ì¤€ì€ [status]ë¡œ íŒë‹¨ë©ë‹ˆë‹¤. [ì™œ ì´ statusë¡œ íŒë‹¨í–ˆëŠ”ì§€ êµ¬ì²´ì ì¸ ì´ìœ ]."
        }}
    ],
    "action_plan": {{
        "steps": [
            {{
                "title": "ì¦ê±° ìˆ˜ì§‘",
                "items": ["êµ¬ì²´ì ì¸ ì¦ê±° ìˆ˜ì§‘ ë°©ë²•"]
            }},
            {{
                "title": "1ì°¨ ëŒ€ì‘",
                "items": ["ì´ˆê¸° ëŒ€ì‘ ë°©ë²•"]
            }},
            {{
                "title": "ìƒë‹´/ì‹ ê³  ë£¨íŠ¸",
                "items": ["ê³ ìš©ë…¸ë™ë¶€ 1350 ìƒë‹´ì„¼í„°", "ì²­ë…„ë…¸ë™ì„¼í„°", "ë…¸ë¬´ì‚¬ ìƒë‹´"]
            }}
        ]
    }},
    "scripts": {{
        "to_company": "íšŒì‚¬ì— ë³´ë‚¼ ì •ì¤‘í•œ ë¬¸ì œ ì œê¸° ë¬¸êµ¬ í…œí”Œë¦¿",
        "to_advisor": "ë…¸ë¬´ì‚¬/ê¸°ê´€ì— ìƒë‹´í•  ë•Œ ì“¸ ì„¤ëª… í…œí”Œë¦¿"
    }},
    "organizations": [
        {{
            "id": "moel",
            "name": "ë…¸ë™ì²­",
            "description": "ì²´ë¶ˆì„ê¸ˆ ì¡°ì‚¬ ë° ì‹œì • ëª…ë ¹, ê·¼ë¡œê¸°ì¤€ë²• ìœ„ë°˜ ì¡°ì‚¬",
            "capabilities": ["ì²´ë¶ˆì„ê¸ˆ ì¡°ì‚¬", "ì‹œì • ëª…ë ¹", "ê·¼ë¡œê¸°ì¤€ë²• ìœ„ë°˜ ì¡°ì‚¬"],
            "requiredDocs": ["ê·¼ë¡œê³„ì•½ì„œ", "ì¶œí‡´ê·¼ ê¸°ë¡", "ê¸‰ì—¬ëª…ì„¸ì„œ"],
            "legalBasis": "ê·¼ë¡œê¸°ì¤€ë²• ì œ110ì¡°: ê·¼ë¡œê°ë…ê´€ì˜ ê¶Œí•œ",
            "website": "https://www.moel.go.kr",
            "phone": "1350"
        }},
        {{
            "id": "labor_attorney",
            "name": "ë…¸ë¬´ì‚¬",
            "description": "ìƒë‹´ ë° ì†Œì†¡ ëŒ€ë¦¬, ê·¼ë¡œ ë¶„ìŸ í•´ê²° ì „ë¬¸",
            "capabilities": ["ìƒë‹´", "ì†Œì†¡ ëŒ€ë¦¬", "ê·¼ë¡œ ë¶„ìŸ í•´ê²°"],
            "requiredDocs": ["ê·¼ë¡œê³„ì•½ì„œ", "ë¬¸ì/ì¹´í†¡ ëŒ€í™”", "ê¸°íƒ€ ì¦ê±° ìë£Œ"],
            "legalBasis": "ë…¸ë¬´ì‚¬ë²•: ê·¼ë¡œ ë¶„ìŸ ì „ë¬¸ ë²•ë¥  ì„œë¹„ìŠ¤"
        }},
        {{
            "id": "comwel",
            "name": "ê·¼ë¡œë³µì§€ê³µë‹¨",
            "description": "ì—°ì°¨ìˆ˜ë‹¹, íœ´ì¼ìˆ˜ë‹¹, ì‹¤ì—…ê¸‰ì—¬ ìƒë‹´",
            "capabilities": ["ì—°ì°¨ìˆ˜ë‹¹ ìƒë‹´", "íœ´ì¼ìˆ˜ë‹¹ ìƒë‹´", "ì‹¤ì—…ê¸‰ì—¬ ì•ˆë‚´"],
            "requiredDocs": ["ê·¼ë¡œê³„ì•½ì„œ", "ì¶œí‡´ê·¼ ê¸°ë¡", "ê¸‰ì—¬ëª…ì„¸ì„œ"],
            "legalBasis": "ê·¼ë¡œê¸°ì¤€ë²• ì œ60ì¡°: ì—°ì°¨ ìœ ê¸‰íœ´ê°€",
            "website": "https://www.comwel.or.kr",
            "phone": "1588-0075"
        }}
    ]
}}

**âš ï¸ ë§¤ìš° ì¤‘ìš”í•œ ì§€ì‹œì‚¬í•­:**

summary í•„ë“œëŠ” ë°˜ë“œì‹œ ë‹¤ìŒ 4ê°œ ì„¹ì…˜ì„ ìˆœì„œëŒ€ë¡œ í¬í•¨í•œ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤:

1. ## ğŸ“Š ìƒí™© ë¶„ì„ì˜ ê²°ê³¼
   - ì œê³µëœ ìƒí™©ì„ ë°”íƒ•ìœ¼ë¡œ í•µì‹¬ ë¬¸ì œì ê³¼ ìœ„í—˜ë„ë¥¼ ìš”ì•½í•˜ì—¬ 2-3ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…

2. ## âš–ï¸ ë²•ì  ê´€ì ì—ì„œ ë³¸ í˜„ì¬ìƒí™©
   - ê´€ë ¨ ë²•ë ¹ì„ ê·¼ê±°ë¡œ í˜„ì¬ ìƒí™©ì´ ë²•ì ìœ¼ë¡œ ì–´ë–»ê²Œ í‰ê°€ë˜ëŠ”ì§€ ì„¤ëª…
   - êµ¬ì²´ì ì¸ ë²•ì  ê·¼ê±°ì™€ íŒë‹¨ ê¸°ì¤€ì„ í¬í•¨í•˜ì—¬ 3-5ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±
   - ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±
   - **âš ï¸ ë§¤ìš° ì¤‘ìš”: RAGë¡œ ê²€ìƒ‰ëœ ì›ë¬¸(snippet)ì„ ê·¸ëŒ€ë¡œ ë‚˜ì—´í•˜ì§€ ë§ˆì„¸ìš”.**
   - **ê²€ìƒ‰ëœ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ "ì‚¬ìš©ìì—ê²Œ ê±´ë„¤ëŠ” ë§"ë¡œ ë³€í™˜í•˜ì—¬ ì„¤ëª…í•˜ì„¸ìš”.**
   - **ë²• ì¡°í•­ì„ ê·¸ëŒ€ë¡œ ìŠì§€ ë§ê³ , '~í•´ì•¼ í•©ë‹ˆë‹¤' ì²´ì˜ í•µì‹¬ ìš”ì•½ í•œ ë¬¸ì¥ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.**
   - ì˜ˆì‹œ:
     - âŒ ë‚˜ìœ ì˜ˆ: "íšŒì‚¬ëŠ” ê·¼ë¡œê³„ì•½ ì²´ê²° ì‹œ ì œ1í•­ì˜ ì¼ë¶€ ë‚´ìš©ì„ ëŒ€ì‹ í•˜ê¸° ìœ„í•œ ê²ƒì„ì„ ëª…í™•íˆ ë°íˆë©´ì„œ... ì œ7ì¡°(ìˆ˜ìŠµê¸°ê°„)..."
     - âœ… ì¢‹ì€ ì˜ˆ: "í‘œì¤€ ì·¨ì—…ê·œì¹™ì— ë”°ë¥´ë©´, ìˆ˜ìŠµê¸°ê°„ì€ ê·¼ë¡œê³„ì•½ì„œì— ëª…í™•íˆ ê¸°ì¬ë˜ì–´ì•¼ íš¨ë ¥ì´ ìˆìŠµë‹ˆë‹¤. êµ¬ë‘ë¡œë§Œ í•©ì˜ëœ ìˆ˜ìŠµê¸°ê°„ì€ ì¸ì •ë°›ê¸° ì–´ë µìŠµë‹ˆë‹¤."
   - ë²•ì¡°ë¬¸ ë²ˆí˜¸(ì œ1í•­, ì œ7ì¡° ë“±)ë‚˜ ë¬¸ì„œ í˜•ì‹ì ì¸ ì„¤ëª…ì„ ë‚˜ì—´í•˜ì§€ ë§ê³ , **"í•´ì•¼ í•  í–‰ë™"ì´ë‚˜ "ê¶Œë¦¬" ì¤‘ì‹¬ìœ¼ë¡œ ì‰½ê²Œ í’€ì–´ì„œ** ì‘ì„±í•˜ì„¸ìš”.

3. ## ğŸ¯ ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” í–‰ë™
   - ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆì„ 3-5ê°œ í•­ëª©ìœ¼ë¡œ ë‚˜ì—´
   - ê° í•­ëª©ì€ "- " í˜•ì‹ìœ¼ë¡œ ì‘ì„±

4. ## ğŸ’¬ ì´ë ‡ê²Œ ë§í•´ë³´ì„¸ìš”
   - íšŒì‚¬ë‚˜ ìƒë‹´ ê¸°ê´€ì— ì‹¤ì œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸êµ¬ í…œí”Œë¦¿ì„ ì œê³µ
   - ì‹¤ì œ ëŒ€í™”ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±

**criteria í•„ë“œ (í•„ìˆ˜ - ë§¤ìš° ì¤‘ìš”):**
- âš ï¸ **criteria í•„ë“œëŠ” ë°˜ë“œì‹œ ìƒì„±í•´ì•¼ í•˜ë©°, ë¹ˆ ë°°ì—´ë¡œ ë°˜í™˜í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
- ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì—ì„œ ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì„ ë°”íƒ•ìœ¼ë¡œ ìƒì„±í•˜ì„¸ìš”.
- ê° ê¸°ì¤€ì€ ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì„ ì°¸ê³ í•˜ì—¬ {{"name": "íŒë‹¨ ê¸°ì¤€ëª…", "status": "likely|unclear|unlikely", "reason": "íŒë‹¨ ì´ìœ  ë° ì„¤ëª…"}} í˜•íƒœë¡œ êµ¬ì„±í•˜ì„¸ìš”.
- **reason í•„ë“œëŠ” ë°˜ë“œì‹œ ë‹¤ìŒ ë‚´ìš©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤ (ìµœì†Œ 3ë¬¸ì¥ ì´ìƒ):**
  1. ìœ„ì˜ "ì°¸ê³  ë²•ë ¹/ê°€ì´ë“œë¼ì¸" ì„¹ì…˜ì—ì„œ ì œê³µëœ ë²•ë ¹/ê°€ì´ë“œë¼ì¸ì˜ ì œëª©ì„ ëª…ì‹œì ìœ¼ë¡œ ì¸ìš© (ã€...ã€ ë˜ëŠ” ã€Œ...ã€ í˜•ì‹)
  2. í•´ë‹¹ ë¬¸ì„œì˜ í•µì‹¬ ë‚´ìš© ìš”ì•½ (1-2ë¬¸ì¥)
  3. í˜„ì¬ ìƒí™©ê³¼ì˜ ì—°ê´€ì„± ë° êµ¬ì²´ì ì¸ íŒë‹¨ ê·¼ê±° (2-3ë¬¸ì¥)
  4. ì™œ ì´ status(likely/unclear/unlikely)ë¡œ íŒë‹¨í–ˆëŠ”ì§€ ì´ìœ 
- **reason í•„ë“œëŠ” ìµœì†Œ 3ë¬¸ì¥ ì´ìƒìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. ë‹¨ìˆœíˆ "ì— ë”°ë¥´ë©´"ì´ë‚˜ "ê´€ë ¨ ë²•ë ¹ ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤" ê°™ì€ ëª¨í˜¸í•œ í‘œí˜„ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ë°˜ë“œì‹œ êµ¬ì²´ì ì¸ ë²•ë ¹ ì œëª©, ë‚´ìš©, íŒë‹¨ ê·¼ê±°ë¥¼ í¬í•¨í•˜ì„¸ìš”.**
- ì˜ˆì‹œ:
  - âŒ ë‚˜ìœ ì˜ˆ: "'ì§ì¥ ë‚´ ê´´ë¡­í˜ íŒë‹¨ ë° ì˜ˆë°© ëŒ€ì‘ ë§¤ë‰´ì–¼â˜….pdf'ì— ë”°ë¥´ë©´"
  - âœ… ì¢‹ì€ ì˜ˆ: "ã€Œì§ì¥ ë‚´ ê´´ë¡­í˜ íŒë‹¨ ë° ì˜ˆë°© ëŒ€ì‘ ë§¤ë‰´ì–¼â˜….pdfã€ì— ë”°ë¥´ë©´, ì§ì¥ ë‚´ ê´´ë¡­í˜ì€ ì—…ë¬´ìƒ ì§€ìœ„ë‚˜ ê´€ê³„ë¥¼ ì´ìš©í•˜ì—¬ í”¼í•´ ê·¼ë¡œìì—ê²Œ ì‹ ì²´ì Â·ì •ì‹ ì  ê³ í†µì„ ì£¼ëŠ” í–‰ìœ„ë¡œ ì •ì˜ë©ë‹ˆë‹¤. ì œê³µëœ ìƒí™©ì—ì„œ ìƒì‚¬ê°€ ë¶€ë‹¹í•œ ì§€ì‹œì™€ ëª¨ìš•ì  ì–¸í–‰ì„ ë°˜ë³µì ìœ¼ë¡œ í–‰í•œ ê²ƒì€ ì§ì¥ ë‚´ ê´´ë¡­í˜ì— í•´ë‹¹í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. íŠ¹íˆ ë§¤ë‰´ì–¼ì—ì„œ ëª…ì‹œí•œ 'ë°˜ë³µì ì´ê³  ì§€ì†ì ì¸ í–‰ìœ„' ìš”ê±´ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤."
- statusëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:
  - "likely": í•´ë‹¹ ê¸°ì¤€ì´ ì¶©ì¡±ë˜ëŠ” ê²½ìš° (ë²•ì  ìš”ê±´ì„ ë§Œì¡±í•¨)
  - "unclear": í•´ë‹¹ ê¸°ì¤€ì´ ë¶€ë¶„ì ìœ¼ë¡œ ì¶©ì¡±ë˜ê±°ë‚˜ ë¶ˆëª…í™•í•œ ê²½ìš°
  - "unlikely": í•´ë‹¹ ê¸°ì¤€ì´ ì¶©ì¡±ë˜ì§€ ì•ŠëŠ” ê²½ìš° (ë²•ì  ìš”ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠìŒ)
- 3~5ê°œ ì •ë„ë¡œ êµ¬ì„±í•˜ì„¸ìš”.
- ê° criteriaëŠ” ì œê³µëœ ìƒí™©ê³¼ ê´€ë ¨ ë²•ë ¹ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬ì²´ì ì¸ íŒë‹¨ ê¸°ì¤€ì„ ì œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

**organizations í•„ë“œ (í•„ìˆ˜):**
- ìƒí™© ìœ í˜•ì— ë§ëŠ” ì¶”ì²œ ê¸°ê´€ ëª©ë¡ì„ ìƒì„±í•˜ì„¸ìš”.
- ê° ê¸°ê´€ì€ {{"id": "ê¸°ê´€ID", "name": "ê¸°ê´€ëª…", "description": "ì„¤ëª…", "capabilities": ["ì„œë¹„ìŠ¤1", "ì„œë¹„ìŠ¤2"], "requiredDocs": ["í•„ìš”ìë£Œ1"], "legalBasis": "ë²•ì ê·¼ê±°", "website": "ì›¹ì‚¬ì´íŠ¸URL", "phone": "ì „í™”ë²ˆí˜¸"}} í˜•íƒœì…ë‹ˆë‹¤.
- ìƒí™© ìœ í˜•ë³„ ì¶”ì²œ ê¸°ê´€:
  - unpaid_wage (ì„ê¸ˆì²´ë¶ˆ): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
  - harassment (ê´´ë¡­í˜): ê³ ìš©ë…¸ë™ë¶€ ê³ ê°ìƒë‹´ì„¼í„°(moel_complaint), êµ­ê°€ì¸ê¶Œìœ„ì›íšŒ(human_rights), ë…¸ë¬´ì‚¬(labor_attorney)
  - unfair_dismissal (ë¶€ë‹¹í•´ê³ ): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
  - overtime (ê·¼ë¡œì‹œê°„): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
  - probation (ìˆ˜ìŠµ): ë…¸ë™ì²­(moel), ë…¸ë¬´ì‚¬(labor_attorney), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
  - unknown (ê¸°íƒ€): ë…¸ë¬´ì‚¬(labor_attorney), ë…¸ë™ì²­(moel), ê·¼ë¡œë³µì§€ê³µë‹¨(comwel)
- ê° ê¸°ê´€ì˜ ì •ë³´ëŠ” ì •í™•í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”:
  - ë…¸ë™ì²­: id="moel", phone="1350", website="https://www.moel.go.kr"
  - ë…¸ë¬´ì‚¬: id="labor_attorney", phone ì—†ìŒ, website ì—†ìŒ
  - ê·¼ë¡œë³µì§€ê³µë‹¨: id="comwel", phone="1588-0075", website="https://www.comwel.or.kr"
  - ê³ ìš©ë…¸ë™ë¶€ ê³ ê°ìƒë‹´ì„¼í„°: id="moel_complaint", phone="1350", website="https://1350.moel.go.kr/home/hp/main/hpmain.do"
  - êµ­ê°€ì¸ê¶Œìœ„ì›íšŒ: id="human_rights", phone="1331", website="https://www.humanrights.go.kr"
- 3~5ê°œ ì •ë„ë¡œ êµ¬ì„±í•˜ì„¸ìš”.

ê¸°íƒ€ ì‚¬í•­:
- ëª¨ë“  ì‘ë‹µì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- summaryëŠ” ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ê° ì„¹ì…˜ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì„¸ìš”.
- action_planì˜ stepsëŠ” 3ë‹¨ê³„ ì •ë„ë¡œ êµ¬ì„±í•˜ì„¸ìš”.
- scriptsëŠ” ì‹¤ì œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸êµ¬ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- **âš ï¸ ë§¤ìš° ì¤‘ìš”: criteria í•„ë“œëŠ” ë°˜ë“œì‹œ 3~5ê°œì˜ í•­ëª©ì„ í¬í•¨í•´ì•¼ í•˜ë©°, ê° í•­ëª©ì˜ reason í•„ë“œëŠ” ìµœì†Œ 3ë¬¸ì¥ ì´ìƒì˜ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. "ê´€ë ¨ ë²•ë ¹ ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤" ê°™ì€ ëª¨í˜¸í•œ í‘œí˜„ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.**

JSON í˜•ì‹ë§Œ ë°˜í™˜í•˜ì„¸ìš”. summary í•„ë“œì—ëŠ” ìœ„ì˜ 4ê°œ ì„¹ì…˜ì„ ëª¨ë‘ í¬í•¨í•œ ì™„ì „í•œ ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”. criteria í•„ë“œì—ëŠ” ë°˜ë“œì‹œ êµ¬ì²´ì ì¸ íŒë‹¨ ê¸°ì¤€ê³¼ ìƒì„¸í•œ reasonì„ í¬í•¨í•˜ì„¸ìš”.
"""
    
    return prompt

